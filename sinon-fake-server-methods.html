<!DOCTYPE html><html lang="en"><head><meta charSet="utf-8"/><meta name="viewport" content="width=device-width"/><meta name="next-head-count" content="2"/><meta property="og:locale" content="en_US"/><link href="https://yowainwright.imgix.net/favicon.png" rel="icon"/><link href="https://yowainwright.imgix.net/apple-icon-120x120.png" rel="apple-touch-icon" itemProp="logo"/><meta name="keywords" content="jeffry, wainwright, jeffry wainwright, code, programmer, artist, athlete, developer, engineer"/><meta name="theme-color" content="#007cf0"/><link rel="manifest" href="https://yowainwright.imgix.net/manifest.json"/><meta name="description" content="Jeffry.in is the daily changelog of Jeffry Wainwright, an engineer living in California."/><meta property="og:site_name" content="Jeffry.in"/><meta property="og:image:width" content="1200"/><meta property="og:image:height" content="600"/><link rel="icon" href="/favicon.ico"/><link rel="preconnect" href="https://fonts.gstatic.com" crossorigin /><link rel="preload" href="./_next/static/css/1bc589ed36c0bcba.css" as="style" crossorigin=""/><link rel="stylesheet" href="./_next/static/css/1bc589ed36c0bcba.css" crossorigin="" data-n-g=""/><noscript data-n-css=""></noscript><script defer="" crossorigin="" nomodule="" src="./_next/static/chunks/polyfills-c67a75d1b6f99dc8.js"></script><script src="./_next/static/chunks/webpack-a3ee844de3fe9ea0.js" defer="" crossorigin=""></script><script src="./_next/static/chunks/framework-fda0a023b274c574.js" defer="" crossorigin=""></script><script src="./_next/static/chunks/main-46db113309061f91.js" defer="" crossorigin=""></script><script src="./_next/static/chunks/pages/_app-a689885a13a996fb.js" defer="" crossorigin=""></script><script src="./_next/static/chunks/769-43bfc1ba15e3c167.js" defer="" crossorigin=""></script><script src="./_next/static/chunks/pages/%5Bslug%5D-f54aaa425028a962.js" defer="" crossorigin=""></script><script src="./_next/static/bWGctUDvkPqdWxNvFEwb1/_buildManifest.js" defer="" crossorigin=""></script><script src="./_next/static/bWGctUDvkPqdWxNvFEwb1/_ssgManifest.js" defer="" crossorigin=""></script><style data-href="https://fonts.googleapis.com/css2?family=Roboto:wght@400;700&display=swap">@font-face{font-family:'Roboto';font-style:normal;font-weight:400;font-display:swap;src:url(https://fonts.gstatic.com/s/roboto/v30/KFOmCnqEu92Fr1Me5g.woff) format('woff')}@font-face{font-family:'Roboto';font-style:normal;font-weight:700;font-display:swap;src:url(https://fonts.gstatic.com/s/roboto/v30/KFOlCnqEu92Fr1MmWUlvAA.woff) format('woff')}@font-face{font-family:'Roboto';font-style:normal;font-weight:400;font-display:swap;src:url(https://fonts.gstatic.com/s/roboto/v30/KFOmCnqEu92Fr1Mu72xKKTU1Kvnz.woff2) format('woff2');unicode-range:U+0460-052F,U+1C80-1C88,U+20B4,U+2DE0-2DFF,U+A640-A69F,U+FE2E-FE2F}@font-face{font-family:'Roboto';font-style:normal;font-weight:400;font-display:swap;src:url(https://fonts.gstatic.com/s/roboto/v30/KFOmCnqEu92Fr1Mu5mxKKTU1Kvnz.woff2) format('woff2');unicode-range:U+0301,U+0400-045F,U+0490-0491,U+04B0-04B1,U+2116}@font-face{font-family:'Roboto';font-style:normal;font-weight:400;font-display:swap;src:url(https://fonts.gstatic.com/s/roboto/v30/KFOmCnqEu92Fr1Mu7mxKKTU1Kvnz.woff2) format('woff2');unicode-range:U+1F00-1FFF}@font-face{font-family:'Roboto';font-style:normal;font-weight:400;font-display:swap;src:url(https://fonts.gstatic.com/s/roboto/v30/KFOmCnqEu92Fr1Mu4WxKKTU1Kvnz.woff2) format('woff2');unicode-range:U+0370-0377,U+037A-037F,U+0384-038A,U+038C,U+038E-03A1,U+03A3-03FF}@font-face{font-family:'Roboto';font-style:normal;font-weight:400;font-display:swap;src:url(https://fonts.gstatic.com/s/roboto/v30/KFOmCnqEu92Fr1Mu7WxKKTU1Kvnz.woff2) format('woff2');unicode-range:U+0102-0103,U+0110-0111,U+0128-0129,U+0168-0169,U+01A0-01A1,U+01AF-01B0,U+0300-0301,U+0303-0304,U+0308-0309,U+0323,U+0329,U+1EA0-1EF9,U+20AB}@font-face{font-family:'Roboto';font-style:normal;font-weight:400;font-display:swap;src:url(https://fonts.gstatic.com/s/roboto/v30/KFOmCnqEu92Fr1Mu7GxKKTU1Kvnz.woff2) format('woff2');unicode-range:U+0100-02AF,U+0304,U+0308,U+0329,U+1E00-1E9F,U+1EF2-1EFF,U+2020,U+20A0-20AB,U+20AD-20C0,U+2113,U+2C60-2C7F,U+A720-A7FF}@font-face{font-family:'Roboto';font-style:normal;font-weight:400;font-display:swap;src:url(https://fonts.gstatic.com/s/roboto/v30/KFOmCnqEu92Fr1Mu4mxKKTU1Kg.woff2) format('woff2');unicode-range:U+0000-00FF,U+0131,U+0152-0153,U+02BB-02BC,U+02C6,U+02DA,U+02DC,U+0304,U+0308,U+0329,U+2000-206F,U+2074,U+20AC,U+2122,U+2191,U+2193,U+2212,U+2215,U+FEFF,U+FFFD}@font-face{font-family:'Roboto';font-style:normal;font-weight:700;font-display:swap;src:url(https://fonts.gstatic.com/s/roboto/v30/KFOlCnqEu92Fr1MmWUlfCRc4AMP6lbBP.woff2) format('woff2');unicode-range:U+0460-052F,U+1C80-1C88,U+20B4,U+2DE0-2DFF,U+A640-A69F,U+FE2E-FE2F}@font-face{font-family:'Roboto';font-style:normal;font-weight:700;font-display:swap;src:url(https://fonts.gstatic.com/s/roboto/v30/KFOlCnqEu92Fr1MmWUlfABc4AMP6lbBP.woff2) format('woff2');unicode-range:U+0301,U+0400-045F,U+0490-0491,U+04B0-04B1,U+2116}@font-face{font-family:'Roboto';font-style:normal;font-weight:700;font-display:swap;src:url(https://fonts.gstatic.com/s/roboto/v30/KFOlCnqEu92Fr1MmWUlfCBc4AMP6lbBP.woff2) format('woff2');unicode-range:U+1F00-1FFF}@font-face{font-family:'Roboto';font-style:normal;font-weight:700;font-display:swap;src:url(https://fonts.gstatic.com/s/roboto/v30/KFOlCnqEu92Fr1MmWUlfBxc4AMP6lbBP.woff2) format('woff2');unicode-range:U+0370-0377,U+037A-037F,U+0384-038A,U+038C,U+038E-03A1,U+03A3-03FF}@font-face{font-family:'Roboto';font-style:normal;font-weight:700;font-display:swap;src:url(https://fonts.gstatic.com/s/roboto/v30/KFOlCnqEu92Fr1MmWUlfCxc4AMP6lbBP.woff2) format('woff2');unicode-range:U+0102-0103,U+0110-0111,U+0128-0129,U+0168-0169,U+01A0-01A1,U+01AF-01B0,U+0300-0301,U+0303-0304,U+0308-0309,U+0323,U+0329,U+1EA0-1EF9,U+20AB}@font-face{font-family:'Roboto';font-style:normal;font-weight:700;font-display:swap;src:url(https://fonts.gstatic.com/s/roboto/v30/KFOlCnqEu92Fr1MmWUlfChc4AMP6lbBP.woff2) format('woff2');unicode-range:U+0100-02AF,U+0304,U+0308,U+0329,U+1E00-1E9F,U+1EF2-1EFF,U+2020,U+20A0-20AB,U+20AD-20C0,U+2113,U+2C60-2C7F,U+A720-A7FF}@font-face{font-family:'Roboto';font-style:normal;font-weight:700;font-display:swap;src:url(https://fonts.gstatic.com/s/roboto/v30/KFOlCnqEu92Fr1MmWUlfBBc4AMP6lQ.woff2) format('woff2');unicode-range:U+0000-00FF,U+0131,U+0152-0153,U+02BB-02BC,U+02C6,U+02DA,U+02DC,U+0304,U+0308,U+0329,U+2000-206F,U+2074,U+20AC,U+2122,U+2191,U+2193,U+2212,U+2215,U+FEFF,U+FFFD}</style></head><body><div id="__next"><nav id="site-nav" class="site-nav" role="navigation" itemType="http://schema.org/SiteNavigationElement"><section class="site-nav__container"><a class="logo" href="/"><h3 class="logo__title">j</h3></a><div class="site-nav__links-wrapper"><ul class="site-nav__items"><li class="site-nav__item site-nav__item--resume"><a class="site-nav__link site-nav__link--resume" href="/resume">Resume</a></li><li class="site-nav__item site-nav__item--archive"><a class="site-nav__link site-nav__link--archive" href="/archive">Archive</a></li><li class="site-nav__item site-nav__item--about"><a class="site-nav__link site-nav__link--about" href="/about">About</a></li></ul><button class="site-nav__toggle" title="Toggle Darkmode"><svg viewBox="0 0 24 24"><path d="M9.37 5.51c-.18.64-.27 1.31-.27 1.99 0 4.08 3.32 7.4 7.4 7.4.68 0 1.35-.09 1.99-.27C17.45 17.19 14.93 19 12 19c-3.86 0-7-3.14-7-7 0-2.93 1.81-5.45 4.37-6.49zM12 3c-4.97 0-9 4.03-9 9s4.03 9 9 9 9-4.03 9-9c0-.46-.04-.92-.1-1.36-.98 1.37-2.58 2.26-4.4 2.26-2.98 0-5.4-2.42-5.4-5.4 0-1.81.89-3.42 2.26-4.4-.44-.06-.9-.1-1.36-.1z"></path></svg></button></div></section></nav><article class="post__article"><header class="post__header"><h1>Digging into Sinon Fake Server Methods</h1><time class="post__time">September 5, 2017</time></header><section class="post__section"><div class="post__container"><div class="post__content"><p><a href="http://sinonjs.org/">Sinon</a> is a powerful library used for stubbing functions, methods, xhr calls, and servers in JavaScript. The library and concept have confused me several times. I&#x27;ve found defining the interface to be challenging. Often, I realize that if the interface is challenging me, I need to rethink it.</p>
<p>In this post, I will explain a bit of Sinon for context and then dig into faking a server with Sinon.</p>
<hr/>
<ul>
<li>Stubbing, in JavaScript, is the act of making a dummy function that acts like a real JavaScript Interface allowing the stubber to fully test the thing they&#x27;re testing. In example, if your testing a method that gets <code>.user()</code> information</li>
<li>Interface, in regards to this post, is the way information is passed, changed, published between methods and functions. If information interface is not optimal, tests should be able to show that.</li>
</ul>
<h4>For this post, here&#x27;s a stub example</h4>
<pre><code class="language-javascript">let server
// then later in code a value is assigned to the variable
server = sinon.fakeServer.create()
</code></pre>
<h2>Why would developers stub a server?</h2>
<p>Engineers stub servers so that they can make fake requests to stubbed servers. The benefit of doing this is that the engineer doesn&#x27;t need a real server and because they&#x27;re not dependent on a real server, they can focus on testing whatever their code does that needs a server to test it.</p>
<h2>A specific example</h2>
<p>In the example below, an ajax request is being made with plain ole&#x27; JavaScript</p>
<pre><code class="language-javascript">export default function getUser(url, callbackInfo) {
  let info = {
    stuff: null,
  }
  const xhr = new XMLHttpRequest()
  xhr.open(&#x27;GET&#x27;, url, true)
  xhr.withCredentials = true
  // update `info` onload
  xhr.addEventListener(&#x27;load&#x27;, () =&gt; {
    if (xhr.status &gt; 400) {
      console.warn(&#x27;Some Warning&#x27;)
      callbackInfo(info)
      return
    }
    const resp = JSON.parse(xhr.responseText)
    const respinfo = resp.info || null
    if (respinfo === null) return

    // update info
    info = {
      stuff: respinfo.status || null,
    }
    callbackInfo(info)
  })

  xhr.addEventListener(&#x27;error&#x27;, () =&gt; {
    console.warn(&#x27;Some Warning&#x27;)
    callbackInfo(info)
  })

  xhr.send()
}
</code></pre>
<p>For the code example above, there is an interface that expects to get information from an ajax request and provide information in response—a response being what comes back from the server.</p>
<h2>How to stub a server with Sinon</h2>
<p>In the example above:</p>
<ul>
<li>The xhr request waits for a load event.</li>
<li>If the response in above a 400, that means there is an error with the response, and the console should warn developers.</li>
<li>If the response is not above a 400, the request will receive a <code>{object}</code> with a <code>status</code>.</li>
<li>In a callback function, the xhr request will return the object <code>{info}</code>.</li>
<li>If there is an <code>error</code> instead of a load event, another warning should be added to the console.</li>
</ul>
<p>No, that there is an example and a bullet list of what&#x27;s happening, Sinon can be used to stub a fake server so we can mock the scenarios of the function.</p>
<p>To do this, first, a stub server must be created.</p>
<pre><code class="language-javascript">server = sinon.fakeServer.create()
</code></pre>
<p>It is beneficial to mock a successful API response</p>
<pre><code class="language-javascript">// fake api
const resp = &#x27;{&quot;info&quot;: &quot;stuff&quot;}&#x27;
</code></pre>
<p>Next, describe what the fake server should response with. This is done with a method provided by Sinon and arguments.</p>
<pre><code class="language-javascript">server.respondWith(url, resp)
</code></pre>
<p>Sinon&#x27;s <code>respondWith</code> method is <em>what the server responds with</em>. It can take in 3 arguments, a method (function), a URL or part of a URL, and the anticipated response. The documentation leaves what the method can do a mistery so this blog post will just stick to what&#x27;s clear: the URL, and the response. When the <code>respondWith</code> method is left to that stubbing out the rest of the fake server response is just a few steps.</p>
<p>The final step is, triggering the fake response.</p>
<pre><code class="language-javascript">server.respond()
</code></pre>
<p>Altogether the stubbed server looks like this.</p>
<pre><code class="language-javascript">// define fake api success reponse
const resp = &#x27;{&quot;info&quot;: &quot;stuff&quot;}&#x27;
// create the fake server
server = sinon.fakeServer.create()
// declare what the fake server should respond with
server.respondWith(url, resp)
// declare the fake response
</code></pre>
<h2>How to fully test a stubbed Sinon server</h2>
<p>Now that this post has gone through stubbing a Sinon server, it will go into how the stub can be used to test the three things that the example function above will require.</p>
<ul>
<li>Test a successful response</li>
<li>Test a failed response</li>
<li>Test a errant response</li>
</ul>
<h3>Testing a successful response</h3>
<pre><code class="language-javascript">// this post reference Mocha testing
it(&#x27;provides `user` information with request success&#x27;, function(done) {
  // the done argument along with this.timeout acts waits for a response for 100ms
  this.timeout(100)
  // create the fake Sinon server
  server = sinon.fakeServer.create()
  // define the end point and its response within args
  server.respondWith(url, resp)
  getUser(url, function info(user) {
    // define user interface
    expect(user).to.be.an(&#x27;Object&#x27;)
    expect(user.accountStatus === &#x27;registered&#x27;).to.be.true
    expect(user.loginState === &#x27;semi&#x27;).to.be.true
    expect(user.memberType === &#x27;146216164134017374&#x27;).to.be.true
    expect(user.userID === &#x27;75607431722225&#x27;).to.be.true
    done()
  })
  // invoke the fake Sinon server response
  server.respond()
})
</code></pre>
<h3>Testing a failed response</h3>
<pre><code class="language-javascript">it(&#x27;provides `user` information with request success&#x27;, () =&gt; {
  // create the fake Sinon server
  server = sinon.fakeServer.create({ respondImmediately: true })
  // because the server response immediately, invoking the response is not needed
  server.respondWith(&#x27;/test&#x27;, resp)
  getUser(url, function info(user) {
    // define a null user interface
    expect(user).to.be.an(&#x27;Object&#x27;)
    expect(user.accountStatus).to.be.null
    expect(user.loginState).to.be.null
    expect(user.memberType).to.be.null
    expect(user.userID).to.be.null
  })
})
</code></pre>
<h3>Testing an errant response</h3>
<pre><code class="language-javascript">it(&#x27;provides null defaults with `user` request error&#x27;, function() {
  // invoke server immediately to enforce error response
  server = sinon.fakeServer.create({ respondImmediately: true })
  server.respondWith(&#x27;/test&#x27;, resp, [404, {}, &#x27;&#x27;])
  getUser(url, function info(user) {
    // define null user interface
    expect(user).to.be.an(&#x27;Object&#x27;)
    expect(user.accountStatus).to.be.null
    expect(user.loginState).to.be.null
    expect(user.memberType).to.be.null
    expect(user.userID).to.be.null
  })
})
</code></pre>
<h2>Conclusion</h2>
<p>This post has described how to use Sinon&#x27;s Fake Server to fully test an interface for an XHR request. XHR Requests can be mocked by Sinon easily with a general understanding of Sinon. After setting up a Mock that works for a product, similar tests can be copied and reused elsewhere. This is why Sinon&#x27;s Fake Server is a powerful tool.</p>
<p>Please use Sinon and <a href="http://sinonjs.org/releases/v2.1.0/fake-xhr-and-server/">Sinon&#x27;s Fake Server</a>. Let <a href="/issue">me</a> know if this post can be improved or if it helped.</p></div><div class="post__giscus"></div></div><aside class="aside"><div class="aside__meta"><header class="aside__header"><h3 class="aside__title">Digging into Sinon Fake Server Methods</h3></header><section class="share"><nav class="share__nav"><button class="share__button">Share Article Link</button></nav></section></div></aside></section></article><footer class="site-footer" role="contentinfo" itemType="http://schema.org/WPFooter"><section class="site-footer__wrapper site-footer__wrapper--main"><article class="site-footer__col site-footer__col--contact"><h3 class="site-footer__title">Contact</h3><address class="site-footer__address"><p class="site-footer__content">Happy to chat, learn, help!</p><p class="site-footer__content"><a href="mailto:yowainwright@gmail.com">yowainwright@gmail.com</a>, Los Angeles, CA</p></address></article><div class="site-footer__col site-footer__col site-footer__col--social"><h3 class="site-footer__title">Connect</h3><nav class="social-footer"><ul class="social-list"><li class="social-list__item social-list__item--showing"><a href="https://github.com/yowainwright" class="social-list__link">Github</a></li><li class="social-list__item social-list__item--showing"><a href="https://instagram.com/yowainwright" class="social-list__link">Instragram</a></li><li class="social-list__item social-list__item--showing"><a href="https://www.linkedin.com/in/jeffrywainwright/" class="social-list__link">LinkedIn</a></li></ul></nav></div><article class="site-footer__col site-footer__col--self"><h3 class="site-footer__title site-footer__title--self">About</h3><figure class="site-footer__figure"><img class="media--circular site-footer__image" src="https://yowainwright.imgix.net/portraits/me-smiling.jpg?w=150&amp;h=150&amp;fit=crop&amp;auto=format" height="100%" width="100%" alt="Me smiling with a beard"/><figcaption class="site-footer__caption"><a class="site-footer__link" href="/"><strong>jeffry.in</strong>, <!-- -->2024</a>, is the blog of<!-- --> <a class="site-footer__link" href="/about">Jeffry (Jeff) Wainwright</a>, a software engineer, person, living in Los Angeles.</figcaption></figure></article></section><section class="site-footer__wrapper site-footer__wrapper--last"><h3 class="site-footer__title site-footer__title--last"><a class="site-footer__link" href="/">jeffry.in</a>, <!-- -->2024</h3></section></footer></div><script id="__NEXT_DATA__" type="application/json" crossorigin="">{"props":{"pageProps":{"frontmatter":{"title":"Digging into Sinon Fake Server Methods","meta":"Digging into Sinon Fake Server Methods and how to use them.","categories":["javascript"],"date":"September 5, 2017","path":"/sinon-fake-server-methods"},"content":"\n[Sinon](http://sinonjs.org/) is a powerful library used for stubbing functions, methods, xhr calls, and servers in JavaScript. The library and concept have confused me several times. I've found defining the interface to be challenging. Often, I realize that if the interface is challenging me, I need to rethink it.\n\nIn this post, I will explain a bit of Sinon for context and then dig into faking a server with Sinon.\n\n---\n\n- Stubbing, in JavaScript, is the act of making a dummy function that acts like a real JavaScript Interface allowing the stubber to fully test the thing they're testing. In example, if your testing a method that gets `.user()` information\n- Interface, in regards to this post, is the way information is passed, changed, published between methods and functions. If information interface is not optimal, tests should be able to show that.\n\n#### For this post, here's a stub example\n\n```javascript\nlet server\n// then later in code a value is assigned to the variable\nserver = sinon.fakeServer.create()\n```\n\n## Why would developers stub a server?\n\nEngineers stub servers so that they can make fake requests to stubbed servers. The benefit of doing this is that the engineer doesn't need a real server and because they're not dependent on a real server, they can focus on testing whatever their code does that needs a server to test it.\n\n## A specific example\n\nIn the example below, an ajax request is being made with plain ole' JavaScript\n\n```javascript\nexport default function getUser(url, callbackInfo) {\n  let info = {\n    stuff: null,\n  }\n  const xhr = new XMLHttpRequest()\n  xhr.open('GET', url, true)\n  xhr.withCredentials = true\n  // update `info` onload\n  xhr.addEventListener('load', () =\u003e {\n    if (xhr.status \u003e 400) {\n      console.warn('Some Warning')\n      callbackInfo(info)\n      return\n    }\n    const resp = JSON.parse(xhr.responseText)\n    const respinfo = resp.info || null\n    if (respinfo === null) return\n\n    // update info\n    info = {\n      stuff: respinfo.status || null,\n    }\n    callbackInfo(info)\n  })\n\n  xhr.addEventListener('error', () =\u003e {\n    console.warn('Some Warning')\n    callbackInfo(info)\n  })\n\n  xhr.send()\n}\n```\n\nFor the code example above, there is an interface that expects to get information from an ajax request and provide information in response—a response being what comes back from the server.\n\n## How to stub a server with Sinon\n\nIn the example above:\n\n- The xhr request waits for a load event.\n- If the response in above a 400, that means there is an error with the response, and the console should warn developers.\n- If the response is not above a 400, the request will receive a `{object}` with a `status`.\n- In a callback function, the xhr request will return the object `{info}`.\n- If there is an `error` instead of a load event, another warning should be added to the console.\n\nNo, that there is an example and a bullet list of what's happening, Sinon can be used to stub a fake server so we can mock the scenarios of the function.\n\nTo do this, first, a stub server must be created.\n\n```javascript\nserver = sinon.fakeServer.create()\n```\n\nIt is beneficial to mock a successful API response\n\n```javascript\n// fake api\nconst resp = '{\"info\": \"stuff\"}'\n```\n\nNext, describe what the fake server should response with. This is done with a method provided by Sinon and arguments.\n\n```javascript\nserver.respondWith(url, resp)\n```\n\nSinon's `respondWith` method is _what the server responds with_. It can take in 3 arguments, a method (function), a URL or part of a URL, and the anticipated response. The documentation leaves what the method can do a mistery so this blog post will just stick to what's clear: the URL, and the response. When the `respondWith` method is left to that stubbing out the rest of the fake server response is just a few steps.\n\nThe final step is, triggering the fake response.\n\n```javascript\nserver.respond()\n```\n\nAltogether the stubbed server looks like this.\n\n```javascript\n// define fake api success reponse\nconst resp = '{\"info\": \"stuff\"}'\n// create the fake server\nserver = sinon.fakeServer.create()\n// declare what the fake server should respond with\nserver.respondWith(url, resp)\n// declare the fake response\n```\n\n## How to fully test a stubbed Sinon server\n\nNow that this post has gone through stubbing a Sinon server, it will go into how the stub can be used to test the three things that the example function above will require.\n\n- Test a successful response\n- Test a failed response\n- Test a errant response\n\n### Testing a successful response\n\n```javascript\n// this post reference Mocha testing\nit('provides `user` information with request success', function(done) {\n  // the done argument along with this.timeout acts waits for a response for 100ms\n  this.timeout(100)\n  // create the fake Sinon server\n  server = sinon.fakeServer.create()\n  // define the end point and its response within args\n  server.respondWith(url, resp)\n  getUser(url, function info(user) {\n    // define user interface\n    expect(user).to.be.an('Object')\n    expect(user.accountStatus === 'registered').to.be.true\n    expect(user.loginState === 'semi').to.be.true\n    expect(user.memberType === '146216164134017374').to.be.true\n    expect(user.userID === '75607431722225').to.be.true\n    done()\n  })\n  // invoke the fake Sinon server response\n  server.respond()\n})\n```\n\n### Testing a failed response\n\n```javascript\nit('provides `user` information with request success', () =\u003e {\n  // create the fake Sinon server\n  server = sinon.fakeServer.create({ respondImmediately: true })\n  // because the server response immediately, invoking the response is not needed\n  server.respondWith('/test', resp)\n  getUser(url, function info(user) {\n    // define a null user interface\n    expect(user).to.be.an('Object')\n    expect(user.accountStatus).to.be.null\n    expect(user.loginState).to.be.null\n    expect(user.memberType).to.be.null\n    expect(user.userID).to.be.null\n  })\n})\n```\n\n### Testing an errant response\n\n```javascript\nit('provides null defaults with `user` request error', function() {\n  // invoke server immediately to enforce error response\n  server = sinon.fakeServer.create({ respondImmediately: true })\n  server.respondWith('/test', resp, [404, {}, ''])\n  getUser(url, function info(user) {\n    // define null user interface\n    expect(user).to.be.an('Object')\n    expect(user.accountStatus).to.be.null\n    expect(user.loginState).to.be.null\n    expect(user.memberType).to.be.null\n    expect(user.userID).to.be.null\n  })\n})\n```\n\n## Conclusion\n\nThis post has described how to use Sinon's Fake Server to fully test an interface for an XHR request. XHR Requests can be mocked by Sinon easily with a general understanding of Sinon. After setting up a Mock that works for a product, similar tests can be copied and reused elsewhere. This is why Sinon's Fake Server is a powerful tool.\n\nPlease use Sinon and [Sinon's Fake Server](http://sinonjs.org/releases/v2.1.0/fake-xhr-and-server/). Let [me](/issue) know if this post can be improved or if it helped.\n","slug":"sinon-fake-server-methods"},"__N_SSG":true},"page":"/[slug]","query":{"slug":"sinon-fake-server-methods"},"buildId":"bWGctUDvkPqdWxNvFEwb1","assetPrefix":".","isFallback":false,"gsp":true,"scriptLoader":[]}</script></body></html>