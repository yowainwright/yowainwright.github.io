{"version":3,"sources":["../../src/cache-dir/register-service-worker.js"],"names":["pathPrefix","__PREFIX_PATHS__","__PATH_PREFIX__","navigator","serviceWorker","register","then","reg","addEventListener","installingWorker","installing","console","log","state","controller","window","location","reload","emit","error","catch","e"],"mappings":";;AAAA;;;;;;AAEA,IAAIA,gBAAJ;AACA,IAAIC,gBAAJ,EAAsB;AACpBD,eAAaE,eAAb;AACD;;AAED,IAAI,mBAAmBC,SAAvB,EAAkC;AAChCA,YAAUC,aAAV,CACGC,QADH,CACeL,UADf,YAEGM,IAFH,CAEQ,UAASC,GAAT,EAAc;AAClBA,QAAIC,gBAAJ,gBAAoC,YAAM;AACxC;AACA;AACA,UAAMC,mBAAmBF,IAAIG,UAA7B;AACAC,cAAQC,GAAR,qBAAgCH,gBAAhC;AACAA,uBAAiBD,gBAAjB,gBAAiD,YAAM;AACrD,gBAAQC,iBAAiBI,KAAzB;AACE;AACE,gBAAIV,UAAUC,aAAV,CAAwBU,UAA5B,EAAwC;AACtC;AACA;AACA;AACA;AACAC,qBAAOC,QAAP,CAAgBC,MAAhB;AACD,aAND,MAMO;AACL;AACA;AACAN,sBAAQC,GAAR;AACA,gCAAQM,IAAR;AACD;AACD;;AAEF;AACEP,oBAAQQ,KAAR;AACA;AAlBJ;AAoBD,OArBD;AAsBD,KA3BD;AA4BD,GA/BH,EAgCGC,KAhCH,CAgCS,UAASC,CAAT,EAAY;AACjBV,YAAQQ,KAAR,8CAA2DE,CAA3D;AACD,GAlCH;AAmCD","file":"register-service-worker.js","sourcesContent":["import emitter from \"./emitter\"\n\nlet pathPrefix = `/`\nif (__PREFIX_PATHS__) {\n  pathPrefix = __PATH_PREFIX__\n}\n\nif (`serviceWorker` in navigator) {\n  navigator.serviceWorker\n    .register(`${pathPrefix}sw.js`)\n    .then(function(reg) {\n      reg.addEventListener(`updatefound`, () => {\n        // The updatefound event implies that reg.installing is set; see\n        // https://w3c.github.io/ServiceWorker/#service-worker-registration-updatefound-event\n        const installingWorker = reg.installing\n        console.log(`installingWorker`, installingWorker)\n        installingWorker.addEventListener(`statechange`, () => {\n          switch (installingWorker.state) {\n            case `installed`:\n              if (navigator.serviceWorker.controller) {\n                // At this point, the old content will have been purged and the fresh content will\n                // have been added to the cache.\n                // We reload immediately so the user sees the new content.\n                // This could/should be made configurable in the future.\n                window.location.reload()\n              } else {\n                // At this point, everything has been precached.\n                // It's the perfect time to display a \"Content is cached for offline use.\" message.\n                console.log(`Content is now available offline!`)\n                emitter.emit(`sw:installed`)\n              }\n              break\n\n            case `redundant`:\n              console.error(`The installing service worker became redundant.`)\n              break\n          }\n        })\n      })\n    })\n    .catch(function(e) {\n      console.error(`Error during service worker registration:`, e)\n    })\n}\n"]}