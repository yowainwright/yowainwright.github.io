{"pageProps":{"frontmatter":{"title":"Quick Tutorial: Build A Basic Dependency Manager Like Dependabot In 5 Minutes","meta":"This document goes over building the basics of your own dependency manager, like dependabot, for JavaScript ot Typescript using package managers and Github actions.","categories":["dependabot"],"date":"December 23, 2022","path":"/build-your-own-dependabot"},"content":"<p>Scope:_ This project focuses purely on JavaScript <em>and, sure, Typescript ðŸ˜Ž</em> but the same patterns could be applied to other languages and/or systems.</p>\n<hr>\n<h2>Preface, AKA The Problem</h2>\n<p><em>Dependabot is great! Why did I learn how I could replace it?</em></p>\n<hr>\n<p>Over the past 2 years, my beloved tool for updating dependencies seems to be focused on other features, like <a href=\"https://docs.github.com/en/code-security/dependabot/dependabot-security-updates/about-dependabot-security-updates\">security alerts</a>, or has abandoned features I used every day, like it's <a href=\"https://docs.github.com/en/developers/apps\">Github app</a> and <a href=\"https://web.archive.org/web/20201112034046/http://dependabot.com/\">app</a> interfaces. At the very least, it hasn't provided easy ways to update dependencies for 2 features which are fairly standard for JavaScript developmentâ€”<a href=\"https://github.com/dependabot/dependabot-core/issues/1736\">pnpm</a> and <a href=\"https://github.com/dependabot/dependabot-core/issues/4993\">monorepos</a>.</p>\n<h2>Wait! What is Dependabot?</h2>\n<p><em>Well, first off. This post is written from the context of code, using <a href=\"https://git-scm.com/\">Git</a>, and using code libraries which excel the capability of code. If this is not clear or of interest to you, stop reading now!</em></p>\n<hr>\n<p>Dependabot is tool for managing coding project dependencies that are maintained in a git service. Mainly Github. This is important for security and keeping code up to date! Dependabot does this using <a href=\"https://docs.github.com/en/actions/using-workflows/events-that-trigger-workflows\">release, cron, or other events</a> which are performed by git management tools (Github for this post). When a git management tool event triggers Dependabot to update dependencies, Dependabot does this specked to a <a href=\"https://github.com/yowainwright/mini-cookies/blob/master/.github/dependabot.yml\">yml file configuration</a>, where is runs update commands and will create an <a href=\"https://github.com/yowainwright/mini-cookies/pull/95\">update pull request</a> if there are updates.</p>\n<h2>How Can We Make Our Own Dependabot?</h2>\n<p>In the paragraph above, I mentioned how Dependabot works. It perfects tasks based on git management events. The cool thing is we can use those events tooâ€”just like Dependabot.</p>\n<h3>1. Create an action that is triggered by a Git event</h3>\n<p>To build our own Dependabot in 5 mins, let's use cron and a github action like so:</p>\n<pre class=\"language-yml\"><code class=\"language-yml code-highlight\"><span class=\"code-line\"><span class=\"token key atrule\">name</span><span class=\"token punctuation\">:</span> update dependencies\n</span><span class=\"code-line\">\n</span><span class=\"code-line\"><span class=\"token key atrule\">on</span><span class=\"token punctuation\">:</span>\n</span><span class=\"code-line\">  <span class=\"token key atrule\">schedule</span><span class=\"token punctuation\">:</span>\n</span><span class=\"code-line\">    <span class=\"token comment\"># This will run at 5am on Monday's</span>\n</span><span class=\"code-line\">    <span class=\"token punctuation\">-</span> <span class=\"token key atrule\">cron</span><span class=\"token punctuation\">:</span>  <span class=\"token string\">'0 5 * * 1'</span>\n</span><span class=\"code-line\">    <span class=\"token comment\"># The cron reference below is for every 5 minutes (useful for debugging)</span>\n</span><span class=\"code-line\">    <span class=\"token comment\"># - cron: '*/5 * * * *'</span>\n</span></code></pre>\n<p><em>Cool. Now we are using a Github Action to run a cron job in a time range that we control!</em></p>\n<h3>2. Run a script to update our dependencies</h3>\n<p>Next up, we'll want to update our dependencies. For this I'm using pnpmâ€”but npm and yarn work the same. <em>Use what you like!</em></p>\n<blockquote>\n<h3>All JavaScript package managers have update commands that can be run to update dependencies!</h3>\n</blockquote>\n<pre class=\"language-yml\"><code class=\"language-yml code-highlight\"><span class=\"code-line\">  <span class=\"token punctuation\">...</span>\n</span><span class=\"code-line\">  <span class=\"token key atrule\">steps</span><span class=\"token punctuation\">:</span>\n</span><span class=\"code-line\">      <span class=\"token punctuation\">-</span> <span class=\"token key atrule\">uses</span><span class=\"token punctuation\">:</span> actions/checkout@v3\n</span><span class=\"code-line\">      <span class=\"token punctuation\">-</span> <span class=\"token key atrule\">uses</span><span class=\"token punctuation\">:</span> pnpm/action<span class=\"token punctuation\">-</span>setup@v2.2.2\n</span><span class=\"code-line\">        <span class=\"token key atrule\">with</span><span class=\"token punctuation\">:</span>\n</span><span class=\"code-line\">          <span class=\"token key atrule\">version</span><span class=\"token punctuation\">:</span> latest\n</span><span class=\"code-line\">      <span class=\"token punctuation\">-</span> <span class=\"token key atrule\">name</span><span class=\"token punctuation\">:</span> Use Node.js $<span class=\"token punctuation\">{</span><span class=\"token punctuation\">{</span> matrix.node<span class=\"token punctuation\">-</span>version <span class=\"token punctuation\">}</span><span class=\"token punctuation\">}</span>\n</span><span class=\"code-line\">        <span class=\"token key atrule\">uses</span><span class=\"token punctuation\">:</span> actions/setup<span class=\"token punctuation\">-</span>node@v3\n</span><span class=\"code-line\">        <span class=\"token key atrule\">with</span><span class=\"token punctuation\">:</span>\n</span><span class=\"code-line\">          <span class=\"token key atrule\">node-version</span><span class=\"token punctuation\">:</span> $<span class=\"token punctuation\">{</span><span class=\"token punctuation\">{</span> matrix.node<span class=\"token punctuation\">-</span>version <span class=\"token punctuation\">}</span><span class=\"token punctuation\">}</span>\n</span><span class=\"code-line\">          <span class=\"token key atrule\">cache</span><span class=\"token punctuation\">:</span> <span class=\"token string\">'pnpm'</span>\n</span><span class=\"code-line\">      <span class=\"token punctuation\">-</span> <span class=\"token key atrule\">run</span><span class=\"token punctuation\">:</span> pnpm install <span class=\"token punctuation\">-</span><span class=\"token punctuation\">-</span>no<span class=\"token punctuation\">-</span>frozen<span class=\"token punctuation\">-</span>lockfile\n</span><span class=\"code-line\">      <span class=\"token punctuation\">-</span> <span class=\"token key atrule\">run</span><span class=\"token punctuation\">:</span> pnpm update\n</span></code></pre>\n<h3>3. Finally, we should create a pull request with our updates</h3>\n<p>Lastly, we'll want to create a PR with our updates. For this, the fastest way is using <a href=\"https://github.com/peter-evans\">Peter Evans</a> <a href=\"https://github.com/peter-evans/create-pull-request\">Create Pull Request Action</a>.</p>\n<blockquote>\n<p>You could build this yourself using the Github API. You can also replicate this functionality using the <a href=\"https://cli.github.com/\">GH cli</a> but that will take a bit more than 5 minutes.</p>\n</blockquote>\n<pre class=\"language-yml\"><code class=\"language-yml code-highlight\"><span class=\"code-line\">    <span class=\"token punctuation\">...</span>\n</span><span class=\"code-line\">    <span class=\"token punctuation\">-</span> <span class=\"token key atrule\">name</span><span class=\"token punctuation\">:</span> Create Pull Request\n</span><span class=\"code-line\">        <span class=\"token key atrule\">uses</span><span class=\"token punctuation\">:</span> peter<span class=\"token punctuation\">-</span>evans/create<span class=\"token punctuation\">-</span>pull<span class=\"token punctuation\">-</span>request@v4\n</span><span class=\"code-line\">        <span class=\"token key atrule\">with</span><span class=\"token punctuation\">:</span>\n</span><span class=\"code-line\">            <span class=\"token key atrule\">token</span><span class=\"token punctuation\">:</span> $<span class=\"token punctuation\">{</span><span class=\"token punctuation\">{</span> secrets.PR_CREATE_TOKEN <span class=\"token punctuation\">}</span><span class=\"token punctuation\">}</span>\n</span><span class=\"code-line\">            <span class=\"token key atrule\">commit-message</span><span class=\"token punctuation\">:</span> Update dependencies\n</span><span class=\"code-line\">            <span class=\"token key atrule\">title</span><span class=\"token punctuation\">:</span> <span class=\"token string\">\"[dependencies]  update dependencies\"</span>\n</span><span class=\"code-line\">            <span class=\"token key atrule\">body</span><span class=\"token punctuation\">:</span> <span class=\"token punctuation\">|</span><span class=\"token scalar string\">\n</span></span><span class=\"code-line\"><span class=\"token scalar string\">              ## Dependency updates\n</span></span><span class=\"code-line\"><span class=\"token scalar string\">              Auto-generated using [create-pull-request][2]\n</span></span><span class=\"code-line\"><span class=\"token scalar string\">              [1]: https://github.com/&#x3C;org/user name>/&#x3C;repo name>\n</span></span><span class=\"code-line\"><span class=\"token scalar string\">              [2]: https://github.com/peter-evans/create-pull-request</span>\n</span><span class=\"code-line\">            <span class=\"token key atrule\">branch</span><span class=\"token punctuation\">:</span> update<span class=\"token punctuation\">-</span>dependencies\n</span></code></pre>\n<hr>\n<p>Quick note: You'll notice there is a required token in order to be able to create a pull request. That might be another post but <a href=\"https://docs.github.com/en/authentication/keeping-your-account-and-data-secure/creating-a-personal-access-token\">here's a link</a> for now!</p>\n<hr>\n<h3>Here's a summary (aka all the yml)</h3>\n<pre class=\"language-yml\"><code class=\"language-yml code-highlight\"><span class=\"code-line\"><span class=\"token key atrule\">name</span><span class=\"token punctuation\">:</span> update dependencies\n</span><span class=\"code-line\">\n</span><span class=\"code-line\"><span class=\"token key atrule\">on</span><span class=\"token punctuation\">:</span>\n</span><span class=\"code-line\">  <span class=\"token key atrule\">schedule</span><span class=\"token punctuation\">:</span>\n</span><span class=\"code-line\">    <span class=\"token punctuation\">-</span> <span class=\"token key atrule\">cron</span><span class=\"token punctuation\">:</span>  <span class=\"token string\">'0 5 * * 1'</span>\n</span><span class=\"code-line\">    <span class=\"token comment\"># - cron: '*/5 * * * *'</span>\n</span><span class=\"code-line\">\n</span><span class=\"code-line\"><span class=\"token key atrule\">jobs</span><span class=\"token punctuation\">:</span>\n</span><span class=\"code-line\">  <span class=\"token key atrule\">udpate-deps</span><span class=\"token punctuation\">:</span>\n</span><span class=\"code-line\">    <span class=\"token key atrule\">runs-on</span><span class=\"token punctuation\">:</span> ubuntu<span class=\"token punctuation\">-</span>latest\n</span><span class=\"code-line\">\n</span><span class=\"code-line\">    <span class=\"token key atrule\">strategy</span><span class=\"token punctuation\">:</span>\n</span><span class=\"code-line\">      <span class=\"token key atrule\">matrix</span><span class=\"token punctuation\">:</span>\n</span><span class=\"code-line\">        <span class=\"token key atrule\">node-version</span><span class=\"token punctuation\">:</span> <span class=\"token punctuation\">[</span>16.x<span class=\"token punctuation\">]</span>\n</span><span class=\"code-line\">\n</span><span class=\"code-line\">    <span class=\"token key atrule\">steps</span><span class=\"token punctuation\">:</span>\n</span><span class=\"code-line\">      <span class=\"token punctuation\">-</span> <span class=\"token key atrule\">uses</span><span class=\"token punctuation\">:</span> actions/checkout@v3\n</span><span class=\"code-line\">      <span class=\"token punctuation\">-</span> <span class=\"token key atrule\">uses</span><span class=\"token punctuation\">:</span> pnpm/action<span class=\"token punctuation\">-</span>setup@v2.2.2\n</span><span class=\"code-line\">        <span class=\"token key atrule\">with</span><span class=\"token punctuation\">:</span>\n</span><span class=\"code-line\">          <span class=\"token key atrule\">version</span><span class=\"token punctuation\">:</span> latest\n</span><span class=\"code-line\">      <span class=\"token punctuation\">-</span> <span class=\"token key atrule\">name</span><span class=\"token punctuation\">:</span> Use Node.js $<span class=\"token punctuation\">{</span><span class=\"token punctuation\">{</span> matrix.node<span class=\"token punctuation\">-</span>version <span class=\"token punctuation\">}</span><span class=\"token punctuation\">}</span>\n</span><span class=\"code-line\">        <span class=\"token key atrule\">uses</span><span class=\"token punctuation\">:</span> actions/setup<span class=\"token punctuation\">-</span>node@v3\n</span><span class=\"code-line\">        <span class=\"token key atrule\">with</span><span class=\"token punctuation\">:</span>\n</span><span class=\"code-line\">          <span class=\"token key atrule\">node-version</span><span class=\"token punctuation\">:</span> $<span class=\"token punctuation\">{</span><span class=\"token punctuation\">{</span> matrix.node<span class=\"token punctuation\">-</span>version <span class=\"token punctuation\">}</span><span class=\"token punctuation\">}</span>\n</span><span class=\"code-line\">          <span class=\"token key atrule\">cache</span><span class=\"token punctuation\">:</span> <span class=\"token string\">'pnpm'</span>\n</span><span class=\"code-line\">      <span class=\"token punctuation\">-</span> <span class=\"token key atrule\">run</span><span class=\"token punctuation\">:</span> pnpm install <span class=\"token punctuation\">-</span><span class=\"token punctuation\">-</span>no<span class=\"token punctuation\">-</span>frozen<span class=\"token punctuation\">-</span>lockfile\n</span><span class=\"code-line\">      <span class=\"token punctuation\">-</span> <span class=\"token key atrule\">run</span><span class=\"token punctuation\">:</span> pnpm update\n</span><span class=\"code-line\">      <span class=\"token punctuation\">-</span> <span class=\"token key atrule\">name</span><span class=\"token punctuation\">:</span> Create Pull Request\n</span><span class=\"code-line\">        <span class=\"token key atrule\">uses</span><span class=\"token punctuation\">:</span> peter<span class=\"token punctuation\">-</span>evans/create<span class=\"token punctuation\">-</span>pull<span class=\"token punctuation\">-</span>request@v4\n</span><span class=\"code-line\">        <span class=\"token key atrule\">with</span><span class=\"token punctuation\">:</span>\n</span><span class=\"code-line\">            <span class=\"token key atrule\">token</span><span class=\"token punctuation\">:</span> $<span class=\"token punctuation\">{</span><span class=\"token punctuation\">{</span> secrets.PR_CREATE_TOKEN <span class=\"token punctuation\">}</span><span class=\"token punctuation\">}</span>\n</span><span class=\"code-line\">            <span class=\"token key atrule\">commit-message</span><span class=\"token punctuation\">:</span> Update dependencies\n</span><span class=\"code-line\">            <span class=\"token key atrule\">title</span><span class=\"token punctuation\">:</span> <span class=\"token string\">\"update dependencies\"</span>\n</span><span class=\"code-line\">            <span class=\"token key atrule\">body</span><span class=\"token punctuation\">:</span> <span class=\"token punctuation\">|</span><span class=\"token scalar string\">\n</span></span><span class=\"code-line\"><span class=\"token scalar string\">              ## Dependency updates\n</span></span><span class=\"code-line\"><span class=\"token scalar string\">              [1]: https://github.com/&#x3C;org/user name>/&#x3C;repo name>\n</span></span><span class=\"code-line\"><span class=\"token scalar string\">              [2]: https://github.com/peter-evans/create-pull-request</span>\n</span><span class=\"code-line\">            <span class=\"token key atrule\">branch</span><span class=\"token punctuation\">:</span> update<span class=\"token punctuation\">-</span>dependencies\n</span></code></pre>\n<hr>\n<p><em>This post is in progress! More to come!</em></p>","slug":"build-your-own-dependabot"},"__N_SSG":true}