{"pageProps":{"frontmatter":{"title":"Document Cookies Are a Useful Tool With A Simple API With Some Nunaces","meta":"This brief artice covers nuances of document.cookie and how to use it to store and access data.","categories":["code","javascript","html"],"date":"February 5, 2022","path":"/document-cookie-nuances"},"content":"\n[Document Cookie](https://developer.mozilla.org/en-US/docs/Web/API/Document/cookie) is a part of the HTML Document. It's used on many, if not most, websites to store data.\nAlthough, `document.cookie` is a string, there are subtle nuances to its API which can be misunderstood.\nIn this article, these nuances are explored in _just enough_ detail to, hopefully, make `document.cookie` even more understandable.\n\n## The Basics of Document Cookie\n\nCookies can be created or referenced via the `document.cookie` property.\n\nTo create a cookie, all that is needed is something very simple.\n\n```javascript\ndocument.cookie = '<key>=<value>;';\n```\n\nReading cookies is very simple as well.\n\n```javascript\nconst cookies = new UrlSearchParams(document.cookie.replaceAll('; ', '&'));\ncookies.get('<key>');\n```\n\n## Cookie Attributes Are Write Only (Nuance 1)\n\nAfter reading \"The Basics of Document Cookie\" section above, Cookies are incredibly simple to understand.\nHowever, if viewing [MDN's](https://developer.mozilla.org/en-US/docs/Web/API/Document/cookie) description of `document.cookie`, you'll notice attributes can be added to a cookie to control its behavior.\nThis concept is easy to understand. However, when viewing the API for adding attributes, it's slightly more confusing.\n\n```javascript\ndocument.cookie = '<key1>=value1; expires=<date1>; path=<path>; domain=<domain>; secure; httponly';\ndocument.cookie = '<key2>=value2; expires=<dat2>; path=<path>;secure; httponly';\nconst cookies = new UrlSearchParams(document.cookie);\nObject.fromEntries(cookies); // { key1: 'value1', key2: 'value2' }\n```\n\n### Code Observations\n\n- When reading the cookie output, all attributes are removed\n- Each cookie only has an accessible `key` and `value`\n\n### Browser Observation\n\n- Cookie attributes can be viewed in the browser only!\n\n---\n\n## Cookie Updates (Nuance 2)\n\nHint, a Cookie cannot be updated. It can only be re-written!\nThe good news is that because a cookie is only a string containing a key and value separated by a `=`, it is easy to find a replace with code.\n\nLets see this in in action!\n\n```javascript\nconst cookies = new UrlSearchParams(document.cookie); // '<key1>=<value`>;<key2>=<value2>;'\ncookies.set('<key>', '<value>');\n// note: when adding attributes the code  to update a cookie is slightly more complex\n```\n\n### Code Observation\n\n- Cookies can't be updated. They can be re-written!\n- It is important to remember when re-writing a cookie to set necessary attributes!\n- It is important when designing the tech spec of a cookie to plan for attributes being write-only!\n\n### Browser Obverations\n\n- When viewing `cookies` assigned to `document.cookie` in a string, `attributes` are removed\n- Cookie key and value pairs are separated by a `=` within the `cookies` string.\n- Cookies are separated by a `;` with the `cookies` string\n\n---\n## Adding Multiple Cookies (Nuance 3)\n\nWhen retrieving cookies, executing `console.log(document.cookie)`  will print all of the cookies on the document as key value pairs. In that same space, it isn’t far fetched to think multiple cookies could be added the same way—`document.cookie='foo=bar; biz=baz;'`. However, that could will only assign the first cookie.\n\nTo add multiple cookies, each cookie must be added in a separate `document.cookie` assignment like the code block below.\n\n```javascript\n  [{ key: 'foo', value: 'bar' }, { key: 'biz', value: 'baz' }].forEach(({ key, value }) => document.cookie = `${key}=${value};`);\n  document.cookie; // 'foo=bar; biz=baz;'\n```\n\n### Code Observation\n\n- Add cookies one at a time with the `document.cookie=\"<key>=<value>;\"` assignment\n- Read cookies all at the same time by logging `document.cookie`\n- Each cookie must be added by assigning a key value pair to `document.cookie`\n## Reading Multiple Added Cookies (Nuance 4)\n\nWhen assigning a cookie, attributes are added with the same value as the key and value pair `=`, and `;`.\nWeirdly, when retrieving cookies, each cookie represented by a key and value pair is also seperated by a `=`, and a `;`.\n\n```javascript\ndocument.cookie = '<key1>=<value1>; expires=<date1>; path=<path>; domain=<domain>; secure; httponly';\ndocument.cookie; // '<key1>=<value1>;'\n```\n\n### Code Observation\n\n- Don't worry about creating a cookie string with attributes and not being able to filter it among cookies and attributes!\n- Do worry about writing tech spec which accounts for expires to only be re-written, not updated!\n- Remember cookie keys are are unique, in that if you assign a cookie with the same key, it will overwrite the other cookie!\n## Deleting Cookies (Nuance 5)\n\nDeleting cookies is more complicated than expected. In order to delete the cookie, it must be assigned to no value as well as have its `Max-age` set to `-1`. It looks like this `document.cookie=\"foo=; Max-age=-1;\";` . There is much discussion on Stackoverflow and the internet on the best way to delete cookies. Often the use of the setting the `expires` attribute to a date in the past is mentioned. However, defining a historical date seems more complex that setting a the Max-age to `-1`.\n\n```javascript\n  document.cookie = 'foo=bar;'; // foo=bar\n  document.cookie = 'foo=; Max-age=-1;'; // empty\n```\n\n### Code Observation\n\n- Delete cookies by assigning the cookie value to nothing and setting the Max-age or expires\n- `Max-age` looks like a cleaner way to delete cookies vs `expires`\n- Deleting cookies is can only be done 1 at a time, just like adding cookies\n\n### Browser Observations\n\n- If you only set the cookie value to empty (`document.cookie = \"foo=;\";`) (and don't set a Max-age or expires), the cookie will still display in the browser, but without value\n- If you set the cookie value to empty and set the max-age to -1, the cookie will not display in the browser and will be deleted completely (`document.cookie = \"foo=;max-age=-1;\";`)\n\n## Final thoughts\n\nCookies are a very simple useful way to store data.\nThe fact that they are write-only and can't be updated is important to understand.\nOnce those 2 points are understood, using cookies should be fun and generally easy.\nLastely, attributes are valuable for managing cookie behavior and keeping them secure!\nJust remember they're only viewable in a browser's dev tools.\n\n---\n\nBefore writing this post, I did get caught up in the nuances I have tried to describe in this article.\nI always used [js-cookie](https://github.com/js-cookie/js-cookie) or similar so the nuances of `document.cookie` were hidden.\nI wrote this simple utility, [mini-cookies](https://github.com/yowainwright/mini-cookies) with 0 dependencies to abstract these nuaces—but in a very mimimal way.\nPlease reach out if you have suggestions!\n\nHappy Hacking!\n"},"__N_SSG":true}