{"pageProps":{"frontmatter":{"title":"Enabling Intelligent Tab Completion in Zsh without High Memory Usage","meta":"This post provides quick tips on how to enable Zsh Tab Completion to provide intelligent completion in Zsh without the bloat.","categories":["code","zsh","terminal","bash"],"date":"May 5, 2024","path":"/lightweight-intelligent-completion-in-zsh"},"content":"<p>Over the last few years, exciting user interface ideas have come on the scene for terminals like <a href=\"https://github.com/withfig/fig\">Fig</a> and <a href=\"https://github.com/warpdotdev/Warp\">Warp</a>. These tools provide great initial development experiences. However, after dealing with high memory usage which slows down other areas of software engineering workflows, I found myself asking, 'Is there a way I can get similar functionality without the bloat?'</p>\n<h2>TL;DR</h2>\n<p>There is! By using a few zsh plugins, you can get a lightweight intelligent completion setup. Read more to consider if this setup might benefit your workflow if you use a mac and zsh.</p>\n<h2>Brief Overview of Tools</h2>\n<p>Warp and Fig, and now <a href=\"https://aws.amazon.com/codewhisperer/\">Amazon Q Developer</a>, provide intelligent completion in your terminal by providing suggestions and completion based on current context. Warp, provides a terminal experience redefined with incorporated ai, autocomplete and fresh UI. Fig is more traditional out of the box with <em>some</em> similar features. However, I found these tools to increase memory usage <a href=\"https://github.com/warpdotdev/Warp/issues/2611\">significantly</a>.</p>\n<h2>Why I chose the approach I did</h2>\n<p>Between terminal experiences the use lots of memory and infrastructure processes that run on my machine that do the same, it's important for me to consider how I allocate CPU and memory. Perhaps I could go into more detail on this in a later post. However, for now, here's a quick overview of how I set up my terminal to provide intelligent completion without the bloat.</p>\n<h2>How I set it up</h2>\n<p>I removed fig and warp and installed the following plugins.</p>\n<hr>\n<ul>\n<li><a href=\"https://github.com/ajeetdsouza/zoxide\">zoxide</a>: a fast path history tool,</li>\n<li><a href=\"https://github.com/junegunn/fzf\">fzf</a>: a favorite terminal fuzzy finder, <a href=\"https://github.com/zsh-users/zsh-autosuggestions\">zsh-autosuggestions</a>: auto-suggestions based on terminal commands</li>\n<li><a href=\"https://github.com/Aloxaf/fzf-tab\">fzf-tab</a>: a tab/dropdown-like developer experience which feels similar to fig and warp:</li>\n<li><a href=\"https://github.com/zsh-users/zsh-syntax-highlighting\">zsh-syntax-highlighting</a>: a tool that highlights commands as you type them</li>\n</ul>\n<hr>\n<p>fzf-tab is the star of the show on for this functionality. Setting it up took some work for me.</p>\n<p>I had to configuration the ui which is mostly (if not all copy/pasted from the docs):</p>\n<pre class=\"shiki shiki-themes theme-custom-light theme-custom-dark\" style=\"background-color:#f9f9f9;--shiki-dark-bg:#031030;color:#000000;--shiki-dark:#b3d8e5\" tabindex=\"0\"><button class=\"shiki-copy-button\" aria-label=\"Copy code\" data-copied=\"false\" title=\"Copy code\" onclick=\"const code = this.parentElement.querySelector(&#x27;code&#x27;).textContent; navigator.clipboard.writeText(code); this.setAttribute(&#x27;data-copied&#x27;, &#x27;true&#x27;); this.setAttribute(&#x27;aria-label&#x27;, &#x27;Copied!&#x27;); this.setAttribute(&#x27;title&#x27;, &#x27;Copied!&#x27;); setTimeout(() => { this.setAttribute(&#x27;data-copied&#x27;, &#x27;false&#x27;); this.setAttribute(&#x27;aria-label&#x27;, &#x27;Copy code&#x27;); this.setAttribute(&#x27;title&#x27;, &#x27;Copy code&#x27;); }, 2000);\"><svg class=\"copy-icon\" xmlns=\"http://www.w3.org/2000/svg\" width=\"16\" height=\"16\" viewBox=\"0 0 24 24\" fill=\"none\" stroke=\"currentColor\" stroke-width=\"2\" stroke-linecap=\"round\" stroke-linejoin=\"round\"><rect width=\"14\" height=\"14\" x=\"8\" y=\"8\" rx=\"2\" ry=\"2\"></rect><path d=\"M4 16c-1.1 0-2-.9-2-2V4c0-1.1.9-2 2-2h10c1.1 0 2 .9 2 2\"></path></svg><svg class=\"check-icon\" xmlns=\"http://www.w3.org/2000/svg\" width=\"16\" height=\"16\" viewBox=\"0 0 24 24\" fill=\"none\" stroke=\"currentColor\" stroke-width=\"2\" stroke-linecap=\"round\" stroke-linejoin=\"round\"><path d=\"M20 6 9 17l-5-5\"></path></svg></button><code><span class=\"line highlighted\"><span style=\"color:#E2657E;--shiki-dark:#E2657E\">  zstyle</span><span style=\"color:#007CF0;--shiki-dark:#007CF0\"> ':fzf-tab:complete:cd:*'</span><span style=\"color:#007CF0;--shiki-dark:#007CF0\"> fzf-preview</span><span style=\"color:#007CF0;--shiki-dark:#007CF0\"> 'eza -1 --color=always $realpath'</span></span>\n<span class=\"line\"><span style=\"color:#E2657E;--shiki-dark:#E2657E\">  zstyle</span><span style=\"color:#007CF0;--shiki-dark:#007CF0\"> ':fzf-tab:complete:git-(add|diff|restore):*'</span><span style=\"color:#007CF0;--shiki-dark:#007CF0\"> fzf-preview</span><span style=\"color:#007CF0;--shiki-dark:#007CF0\"> 'git diff $word | delta'</span></span>\n<span class=\"line highlighted\"><span style=\"color:#E2657E;--shiki-dark:#E2657E\">  zstyle</span><span style=\"color:#007CF0;--shiki-dark:#007CF0\"> ':fzf-tab:complete:git-log:*'</span><span style=\"color:#007CF0;--shiki-dark:#007CF0\"> fzf-preview</span><span style=\"color:#007CF0;--shiki-dark:#007CF0\"> 'git log --color=always $word'</span></span>\n<span class=\"line highlighted\"><span style=\"color:#E2657E;--shiki-dark:#E2657E\">  zstyle</span><span style=\"color:#007CF0;--shiki-dark:#007CF0\"> ':fzf-tab:complete:git-help:*'</span><span style=\"color:#007CF0;--shiki-dark:#007CF0\"> fzf-preview</span><span style=\"color:#007CF0;--shiki-dark:#007CF0\"> 'git help $word | bat -plman --color=always'</span></span>\n<span class=\"line\"><span style=\"color:#E2657E;--shiki-dark:#E2657E\">  zstyle</span><span style=\"color:#007CF0;--shiki-dark:#007CF0\"> ':fzf-tab:complete:git-show:*'</span><span style=\"color:#007CF0;--shiki-dark:#007CF0\"> fzf-preview</span><span style=\"color:#007CF0;--shiki-dark:#007CF0\"> 'case \"$group\" in \"commit tag\") git show --color=always $word ;; *) git show --color=always $word | delta ;; esac'</span></span>\n<span class=\"line\"><span style=\"color:#E2657E;--shiki-dark:#E2657E\">  zstyle</span><span style=\"color:#007CF0;--shiki-dark:#007CF0\"> ':fzf-tab:complete:git-checkout:*'</span><span style=\"color:#007CF0;--shiki-dark:#007CF0\"> fzf-preview</span><span style=\"color:#007CF0;--shiki-dark:#007CF0\"> 'case \"$group\" in \"modified file\") git diff $word | delta ;; \"recent commit object name\") git show --color=always $word | delta ;; *) git log --color=always $word ;; esac'</span></span>\n<span class=\"line\"><span style=\"color:#E2657E;--shiki-dark:#E2657E\">  zstyle</span><span style=\"color:#007CF0;--shiki-dark:#007CF0\"> ':completion:*:git-checkout:*'</span><span style=\"color:#007CF0;--shiki-dark:#007CF0\"> sort</span><span style=\"color:#E2657E;--shiki-dark:#E2657E\"> false</span></span>\n<span class=\"line\"><span style=\"color:#E2657E;--shiki-dark:#E2657E\">  zstyle</span><span style=\"color:#007CF0;--shiki-dark:#007CF0\"> ':completion:*:descriptions'</span><span style=\"color:#007CF0;--shiki-dark:#007CF0\"> format</span><span style=\"color:#007CF0;--shiki-dark:#007CF0\"> '[%d]'</span></span>\n<span class=\"line\"><span style=\"color:#E2657E;--shiki-dark:#E2657E\">  zstyle</span><span style=\"color:#007CF0;--shiki-dark:#007CF0\"> ':completion:*'</span><span style=\"color:#007CF0;--shiki-dark:#007CF0\"> list-colors</span><span style=\"color:#000000;--shiki-dark:#B3D8E5\"> $</span><span style=\"--shiki-dark:#FFD700;color:#FFD700\">{</span><span style=\"--shiki-dark:#DA70D6;color:#DA70D6\">(</span><span style=\"color:#007CF0;--shiki-dark:#007CF0\">s</span><span style=\"color:#000000;--shiki-dark:#B3D8E5\">.</span><span style=\"color:#E194B5;--shiki-dark:#E194B5\">:</span><span style=\"color:#000000;--shiki-dark:#B3D8E5\">.</span><span style=\"--shiki-dark:#DA70D6;color:#DA70D6\">)</span><span style=\"color:#007CF0;--shiki-dark:#007CF0\">LS_COLORS</span><span style=\"--shiki-dark:#FFD700;color:#FFD700\">}</span></span>\n<span class=\"line\"><span style=\"color:#E2657E;--shiki-dark:#E2657E\">  zstyle</span><span style=\"color:#007CF0;--shiki-dark:#007CF0\"> ':completion:*'</span><span style=\"color:#007CF0;--shiki-dark:#007CF0\"> menu</span><span style=\"color:#007CF0;--shiki-dark:#007CF0\"> no</span></span>\n<span class=\"line\"><span style=\"color:#E2657E;--shiki-dark:#E2657E\">  zstyle</span><span style=\"color:#007CF0;--shiki-dark:#007CF0\"> ':fzf-tab:complete:cd:*'</span><span style=\"color:#007CF0;--shiki-dark:#007CF0\"> fzf-preview</span><span style=\"color:#007CF0;--shiki-dark:#007CF0\"> 'eza -1 --color=always $realpath'</span></span>\n<span class=\"line\"><span style=\"color:#E2657E;--shiki-dark:#E2657E\">  zstyle</span><span style=\"color:#007CF0;--shiki-dark:#007CF0\"> ':fzf-tab:*'</span><span style=\"color:#007CF0;--shiki-dark:#007CF0\"> switch-group</span><span style=\"color:#007CF0;--shiki-dark:#007CF0\"> '&#x3C;'</span><span style=\"color:#007CF0;--shiki-dark:#007CF0\"> '>'</span></span>\n<span class=\"line\"><span style=\"color:#E2657E;--shiki-dark:#E2657E\">  zstyle</span><span style=\"color:#007CF0;--shiki-dark:#007CF0\"> ':completion:*'</span><span style=\"color:#007CF0;--shiki-dark:#007CF0\"> list-max-items</span><span style=\"color:#B5CEA8;--shiki-dark:#B5CEA8\"> 20</span></span></code></pre>\n<p>I also added more configuration as recommended in the docs with <a href=\"https://github.com/Freed-Wu/fzf-tab-source\">fzf-tab-source</a>:</p>\n<pre class=\"shiki shiki-themes theme-custom-light theme-custom-dark\" style=\"background-color:#f9f9f9;--shiki-dark-bg:#031030;color:#000000;--shiki-dark:#b3d8e5\" tabindex=\"0\"><button class=\"shiki-copy-button\" aria-label=\"Copy code\" data-copied=\"false\" title=\"Copy code\" onclick=\"const code = this.parentElement.querySelector(&#x27;code&#x27;).textContent; navigator.clipboard.writeText(code); this.setAttribute(&#x27;data-copied&#x27;, &#x27;true&#x27;); this.setAttribute(&#x27;aria-label&#x27;, &#x27;Copied!&#x27;); this.setAttribute(&#x27;title&#x27;, &#x27;Copied!&#x27;); setTimeout(() => { this.setAttribute(&#x27;data-copied&#x27;, &#x27;false&#x27;); this.setAttribute(&#x27;aria-label&#x27;, &#x27;Copy code&#x27;); this.setAttribute(&#x27;title&#x27;, &#x27;Copy code&#x27;); }, 2000);\"><svg class=\"copy-icon\" xmlns=\"http://www.w3.org/2000/svg\" width=\"16\" height=\"16\" viewBox=\"0 0 24 24\" fill=\"none\" stroke=\"currentColor\" stroke-width=\"2\" stroke-linecap=\"round\" stroke-linejoin=\"round\"><rect width=\"14\" height=\"14\" x=\"8\" y=\"8\" rx=\"2\" ry=\"2\"></rect><path d=\"M4 16c-1.1 0-2-.9-2-2V4c0-1.1.9-2 2-2h10c1.1 0 2 .9 2 2\"></path></svg><svg class=\"check-icon\" xmlns=\"http://www.w3.org/2000/svg\" width=\"16\" height=\"16\" viewBox=\"0 0 24 24\" fill=\"none\" stroke=\"currentColor\" stroke-width=\"2\" stroke-linecap=\"round\" stroke-linejoin=\"round\"><path d=\"M20 6 9 17l-5-5\"></path></svg></button><code><span class=\"line\"><span style=\"color:#E2657E;--shiki-dark:#E2657E\">  eval</span><span style=\"color:#007CF0;--shiki-dark:#007CF0\"> \"$(</span><span style=\"color:#E2657E;--shiki-dark:#E2657E\">zoxide</span><span style=\"color:#007CF0;--shiki-dark:#007CF0\"> init zsh)\"</span></span>\n<span class=\"line\"><span style=\"color:#E2657E;--shiki-dark:#E2657E\">  source</span><span style=\"color:#007CF0;--shiki-dark:#007CF0\">  $ZSH_CUSTOM</span><span style=\"color:#007CF0;--shiki-dark:#007CF0\">/plugins/fzf-tab-source/fzf-tab-source.plugin.zsh</span></span>\n<span class=\"line\"><span style=\"color:#E2657E;--shiki-dark:#E2657E\">  enable-fzf-tab</span></span></code></pre>\n<h2>Conclusion</h2>\n<p>With these plugins, I have a lightweight intelligent completion setup that doesn't slow down my machine. It didn't take long to setup and the results have been great.</p>","slug":"lightweight-intelligent-completion-in-zsh"},"__N_SSG":true}