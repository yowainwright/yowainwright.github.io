{"pageProps":{"frontmatter":{"title":"Shiki Syntax Highlighting: More features for markdown","meta":"Comprehensive Shiki syntax highlighting implementation with custom themes, diff notation, line highlighting, focus modes, error annotations, interactive copy buttons, and optimized Sass architecture using a scalable variable system.","tags":["Shiki","Syntax Highlighting","Sass","CSS","Performance"],"date":"August 31, 2025","path":"/shiki-syntax"},"content":"<p><a href=\"https://shiki.matsu.io/\">Shiki</a>'s been used on this blog for some time. But it was missing several features that Shiki provides, including language badges, custom transformers for enhanced metadata, and more granular control over code block styling.</p>\n<h2>TL;DR</h2>\n<p><code>https://jeffry.in</code> is updated with Shiki codeblocks, including:</p>\n<ul>\n<li><strong>Shiki Transformers</strong> for titles, diffs, and tooltips</li>\n<li><strong>Simplified Giscus integration</strong> using built-in themes</li>\n<li><strong>Performance optimizations</strong> with <a href=\"https://nextjs.org/\">Next.js</a> dynamic imports</li>\n</ul>\n<hr>\n<h2>Syntax Highlighting Overview</h2>\n<p>Here's a simple example. In the code block below, observe a title, the language badge, a copy button, and Shiki syntax highlighting.</p>\n<div class=\"shiki-wrapper\"><div class=\"shiki-header\"><div class=\"shiki-title\">Basic JavaScript Example</div><div class=\"copy-button-placeholder\" data-code-id=\"code-block-1\"></div></div><div class=\"shiki-language\">TEXT</div><div class=\"copy-button-placeholder\" data-code-id=\"code-block-1\"></div><pre class=\"shiki shiki-themes theme-custom-light theme-custom-dark\" style=\"background-color:#f9f9f9;--shiki-dark-bg:#031030;color:#000000;--shiki-dark:#b3d8e5\" tabindex=\"0\" data-language=\"text\" id=\"code-block-1\"><code><span class=\"line\"><span style=\"color:#569CD6;--shiki-dark:#569CD6\">const</span><span style=\"color:#E2657E;--shiki-dark:#E2657E\"> greeting</span><span style=\"color:#E194B5;--shiki-dark:#E194B5\"> =</span><span style=\"color:#007CF0;--shiki-dark:#007CF0\"> \"Hello, Shiki!\"</span><span style=\"color:#000000;--shiki-dark:#B3D8E5\">;</span></span>\n<span class=\"line\"><span style=\"color:#569CD6;--shiki-dark:#569CD6\">const</span><span style=\"color:#E2657E;--shiki-dark:#E2657E\"> numbers</span><span style=\"color:#E194B5;--shiki-dark:#E194B5\"> =</span><span style=\"color:#000000;--shiki-dark:#B3D8E5\"> </span><span style=\"--shiki-dark:#FFD700;color:#FFD700\">[</span><span style=\"color:#B5CEA8;--shiki-dark:#B5CEA8\">1</span><span style=\"color:#000000;--shiki-dark:#B3D8E5\">, </span><span style=\"color:#B5CEA8;--shiki-dark:#B5CEA8\">2</span><span style=\"color:#000000;--shiki-dark:#B3D8E5\">, </span><span style=\"color:#B5CEA8;--shiki-dark:#B5CEA8\">3</span><span style=\"color:#000000;--shiki-dark:#B3D8E5\">, </span><span style=\"color:#B5CEA8;--shiki-dark:#B5CEA8\">4</span><span style=\"color:#000000;--shiki-dark:#B3D8E5\">, </span><span style=\"color:#B5CEA8;--shiki-dark:#B5CEA8\">5</span><span style=\"--shiki-dark:#FFD700;color:#FFD700\">]</span><span style=\"color:#000000;--shiki-dark:#B3D8E5\">;</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"color:#569CD6;--shiki-dark:#569CD6\">function</span><span style=\"color:#E2657E;--shiki-dark:#E2657E\"> calculateSum</span><span style=\"--shiki-dark:#FFD700;color:#FFD700\">(</span><span style=\"color:#007CF0;--shiki-dark:#007CF0\">arr</span><span style=\"--shiki-dark:#FFD700;color:#FFD700\">)</span><span style=\"color:#000000;--shiki-dark:#B3D8E5\"> </span><span style=\"--shiki-dark:#FFD700;color:#FFD700\">{</span></span>\n<span class=\"line\"><span style=\"color:#E194B5;--shiki-dark:#E194B5\">  return</span><span style=\"color:#007CF0;--shiki-dark:#007CF0\"> arr</span><span style=\"color:#000000;--shiki-dark:#B3D8E5\">.</span><span style=\"color:#E2657E;--shiki-dark:#E2657E\">reduce</span><span style=\"--shiki-dark:#DA70D6;color:#DA70D6\">(</span><span style=\"--shiki-dark:#179FFF;color:#179FFF\">(</span><span style=\"color:#007CF0;--shiki-dark:#007CF0\">sum</span><span style=\"color:#000000;--shiki-dark:#B3D8E5\">, </span><span style=\"color:#007CF0;--shiki-dark:#007CF0\">num</span><span style=\"--shiki-dark:#179FFF;color:#179FFF\">)</span><span style=\"color:#000000;--shiki-dark:#B3D8E5\"> </span><span style=\"color:#569CD6;--shiki-dark:#569CD6\">=</span><span style=\"color:#569CD6;--shiki-dark:#569CD6\">></span><span style=\"color:#007CF0;--shiki-dark:#007CF0\"> sum</span><span style=\"color:#E194B5;--shiki-dark:#E194B5\"> +</span><span style=\"color:#007CF0;--shiki-dark:#007CF0\"> num</span><span style=\"color:#000000;--shiki-dark:#B3D8E5\">, </span><span style=\"color:#B5CEA8;--shiki-dark:#B5CEA8\">0</span><span style=\"--shiki-dark:#DA70D6;color:#DA70D6\">)</span><span style=\"color:#000000;--shiki-dark:#B3D8E5\">;</span></span>\n<span class=\"line\"><span style=\"--shiki-dark:#FFD700;color:#FFD700\">}</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"color:#007CF0;--shiki-dark:#007CF0\">console</span><span style=\"color:#000000;--shiki-dark:#B3D8E5\">.</span><span style=\"color:#E2657E;--shiki-dark:#E2657E\">log</span><span style=\"--shiki-dark:#FFD700;color:#FFD700\">(</span><span style=\"color:#007CF0;--shiki-dark:#007CF0\">greeting</span><span style=\"--shiki-dark:#FFD700;color:#FFD700\">)</span><span style=\"color:#000000;--shiki-dark:#B3D8E5\">;</span></span>\n<span class=\"line\"><span style=\"color:#007CF0;--shiki-dark:#007CF0\">console</span><span style=\"color:#000000;--shiki-dark:#B3D8E5\">.</span><span style=\"color:#E2657E;--shiki-dark:#E2657E\">log</span><span style=\"--shiki-dark:#FFD700;color:#FFD700\">(</span><span style=\"color:#007CF0;--shiki-dark:#007CF0\">`Sum: </span><span style=\"color:#999999;--shiki-dark:#999999\">${</span><span style=\"color:#E2657E;--shiki-dark:#E2657E\">calculateSum</span><span style=\"--shiki-dark:#DA70D6;color:#DA70D6\">(</span><span style=\"color:#007CF0;--shiki-dark:#007CF0\">numbers</span><span style=\"--shiki-dark:#DA70D6;color:#DA70D6\">)</span><span style=\"color:#999999;--shiki-dark:#999999\">}</span><span style=\"color:#007CF0;--shiki-dark:#007CF0\">`</span><span style=\"--shiki-dark:#FFD700;color:#FFD700\">)</span><span style=\"color:#000000;--shiki-dark:#B3D8E5\">;</span></span></code></pre></div>\n<h2>Language Support</h2>\n<p>Shiki supports multiple programming languages. However, I wanted to add the language as a badge which was harder than I had expected.\nI found I could view language information from Shiki but I wasn't able to hoist it to code block headers.\nShiki's architecture transforms and executes at different stages of the code rendering pipeline, and language metadata isn't always accessible in the pre-processing phase where it can be injected into header elements. <code>code()</code> and <code>preprocess()</code> hooks run at different times, and getting data to flow between them requires a little state management through the options object. See below.</p>\n<div class=\"shiki-wrapper\"><div class=\"shiki-header\"><div class=\"shiki-title\">utils.ts - Language Badge Transformer</div><div class=\"copy-button-placeholder\" data-code-id=\"code-block-1\"></div></div><div class=\"shiki-language\">TEXT</div><div class=\"copy-button-placeholder\" data-code-id=\"code-block-1\"></div><pre class=\"shiki shiki-themes theme-custom-light theme-custom-dark\" style=\"background-color:#f9f9f9;--shiki-dark-bg:#031030;color:#000000;--shiki-dark:#b3d8e5\" tabindex=\"0\" data-language=\"text\" id=\"code-block-1\"><code><span class=\"line\"><span style=\"color:#569CD6;--shiki-dark:#569CD6\">function</span><span style=\"color:#E2657E;--shiki-dark:#E2657E\"> transformerLanguageBadge</span><span style=\"--shiki-dark:#FFD700;color:#FFD700\">(</span><span style=\"--shiki-dark:#FFD700;color:#FFD700\">)</span><span style=\"color:#000000;--shiki-dark:#B3D8E5\"> </span><span style=\"--shiki-dark:#FFD700;color:#FFD700\">{</span></span>\n<span class=\"line\"><span style=\"color:#E194B5;--shiki-dark:#E194B5\">  return</span><span style=\"color:#000000;--shiki-dark:#B3D8E5\"> </span><span style=\"--shiki-dark:#DA70D6;color:#DA70D6\">{</span></span>\n<span class=\"line\"><span style=\"color:#007CF0;--shiki-dark:#007CF0\">    name:</span><span style=\"color:#007CF0;--shiki-dark:#007CF0\"> 'language-badge'</span><span style=\"color:#000000;--shiki-dark:#B3D8E5\">,</span></span>\n<span class=\"line\"><span style=\"color:#E2657E;--shiki-dark:#E2657E\">    root</span><span style=\"--shiki-dark:#179FFF;color:#179FFF\">(</span><span style=\"color:#007CF0;--shiki-dark:#007CF0\">node</span><span style=\"--shiki-dark:#179FFF;color:#179FFF\">)</span><span style=\"color:#000000;--shiki-dark:#B3D8E5\"> </span><span style=\"--shiki-dark:#179FFF;color:#179FFF\">{</span></span>\n<span class=\"line\"><span style=\"color:#6A9955;--shiki-dark:#6A9955\">      // Store language from options in root data attribute</span></span>\n<span class=\"line\"><span style=\"color:#569CD6;--shiki-dark:#569CD6\">      const</span><span style=\"color:#E2657E;--shiki-dark:#E2657E\"> lang</span><span style=\"color:#E194B5;--shiki-dark:#E194B5\"> =</span><span style=\"color:#007CF0;--shiki-dark:#007CF0\"> this</span><span style=\"color:#000000;--shiki-dark:#B3D8E5\">.</span><span style=\"color:#007CF0;--shiki-dark:#007CF0\">options</span><span style=\"color:#000000;--shiki-dark:#B3D8E5\">.</span><span style=\"color:#007CF0;--shiki-dark:#007CF0\">lang</span><span style=\"color:#E194B5;--shiki-dark:#E194B5\"> ||</span><span style=\"color:#007CF0;--shiki-dark:#007CF0\"> 'text'</span><span style=\"color:#000000;--shiki-dark:#B3D8E5\">;</span></span>\n<span class=\"line\"><span style=\"color:#007CF0;--shiki-dark:#007CF0\">      node</span><span style=\"color:#000000;--shiki-dark:#B3D8E5\">.</span><span style=\"color:#007CF0;--shiki-dark:#007CF0\">properties</span><span style=\"--shiki-dark:#FFD700;color:#FFD700\">[</span><span style=\"color:#007CF0;--shiki-dark:#007CF0\">'data-language'</span><span style=\"--shiki-dark:#FFD700;color:#FFD700\">]</span><span style=\"color:#000000;--shiki-dark:#B3D8E5\"> </span><span style=\"color:#E194B5;--shiki-dark:#E194B5\">=</span><span style=\"color:#007CF0;--shiki-dark:#007CF0\"> lang</span><span style=\"color:#000000;--shiki-dark:#B3D8E5\">;</span></span>\n<span class=\"line\"><span style=\"color:#000000;--shiki-dark:#B3D8E5\">    </span><span style=\"--shiki-dark:#179FFF;color:#179FFF\">}</span><span style=\"color:#000000;--shiki-dark:#B3D8E5\">,</span></span>\n<span class=\"line\"><span style=\"color:#E2657E;--shiki-dark:#E2657E\">    pre</span><span style=\"--shiki-dark:#179FFF;color:#179FFF\">(</span><span style=\"color:#007CF0;--shiki-dark:#007CF0\">node</span><span style=\"--shiki-dark:#179FFF;color:#179FFF\">)</span><span style=\"color:#000000;--shiki-dark:#B3D8E5\"> </span><span style=\"--shiki-dark:#179FFF;color:#179FFF\">{</span></span>\n<span class=\"line\"><span style=\"color:#6A9955;--shiki-dark:#6A9955\">      // Hoist the language from options to create badge in header</span></span>\n<span class=\"line\"><span style=\"color:#569CD6;--shiki-dark:#569CD6\">      const</span><span style=\"color:#E2657E;--shiki-dark:#E2657E\"> lang</span><span style=\"color:#E194B5;--shiki-dark:#E194B5\"> =</span><span style=\"color:#007CF0;--shiki-dark:#007CF0\"> this</span><span style=\"color:#000000;--shiki-dark:#B3D8E5\">.</span><span style=\"color:#007CF0;--shiki-dark:#007CF0\">options</span><span style=\"color:#000000;--shiki-dark:#B3D8E5\">.</span><span style=\"color:#007CF0;--shiki-dark:#007CF0\">lang</span><span style=\"color:#E194B5;--shiki-dark:#E194B5\"> ||</span><span style=\"color:#007CF0;--shiki-dark:#007CF0\"> 'text'</span><span style=\"color:#000000;--shiki-dark:#B3D8E5\">;</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"color:#6A9955;--shiki-dark:#6A9955\">      // Find or create header</span></span>\n<span class=\"line\"><span style=\"color:#569CD6;--shiki-dark:#569CD6\">      let</span><span style=\"color:#007CF0;--shiki-dark:#007CF0\"> header</span><span style=\"color:#E194B5;--shiki-dark:#E194B5\"> =</span><span style=\"color:#007CF0;--shiki-dark:#007CF0\"> node</span><span style=\"color:#000000;--shiki-dark:#B3D8E5\">.</span><span style=\"color:#007CF0;--shiki-dark:#007CF0\">children</span><span style=\"color:#000000;--shiki-dark:#B3D8E5\">.</span><span style=\"color:#E2657E;--shiki-dark:#E2657E\">find</span><span style=\"--shiki-dark:#FFD700;color:#FFD700\">(</span></span>\n<span class=\"line\"><span style=\"color:#000000;--shiki-dark:#B3D8E5\">        </span><span style=\"--shiki-dark:#DA70D6;color:#DA70D6\">(</span><span style=\"color:#007CF0;--shiki-dark:#007CF0\">child</span><span style=\"--shiki-dark:#DA70D6;color:#DA70D6\">)</span><span style=\"color:#000000;--shiki-dark:#B3D8E5\"> </span><span style=\"color:#569CD6;--shiki-dark:#569CD6\">=</span><span style=\"color:#569CD6;--shiki-dark:#569CD6\">></span><span style=\"color:#007CF0;--shiki-dark:#007CF0\"> child</span><span style=\"color:#000000;--shiki-dark:#B3D8E5\">.</span><span style=\"color:#007CF0;--shiki-dark:#007CF0\">type</span><span style=\"color:#E194B5;--shiki-dark:#E194B5\"> ===</span><span style=\"color:#007CF0;--shiki-dark:#007CF0\"> 'element'</span><span style=\"color:#E194B5;--shiki-dark:#E194B5\"> &#x26;&#x26;</span></span>\n<span class=\"line\"><span style=\"color:#007CF0;--shiki-dark:#007CF0\">                   child</span><span style=\"color:#000000;--shiki-dark:#B3D8E5\">.</span><span style=\"color:#007CF0;--shiki-dark:#007CF0\">properties</span><span style=\"color:#000000;--shiki-dark:#B3D8E5\">?.</span><span style=\"color:#007CF0;--shiki-dark:#007CF0\">className</span><span style=\"color:#000000;--shiki-dark:#B3D8E5\">?.</span><span style=\"color:#E2657E;--shiki-dark:#E2657E\">includes</span><span style=\"--shiki-dark:#DA70D6;color:#DA70D6\">(</span><span style=\"color:#007CF0;--shiki-dark:#007CF0\">'code-header'</span><span style=\"--shiki-dark:#DA70D6;color:#DA70D6\">)</span></span>\n<span class=\"line\"><span style=\"color:#000000;--shiki-dark:#B3D8E5\">      </span><span style=\"--shiki-dark:#FFD700;color:#FFD700\">)</span><span style=\"color:#000000;--shiki-dark:#B3D8E5\">;</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"color:#E194B5;--shiki-dark:#E194B5\">      if</span><span style=\"color:#000000;--shiki-dark:#B3D8E5\"> </span><span style=\"--shiki-dark:#FFD700;color:#FFD700\">(</span><span style=\"color:#E194B5;--shiki-dark:#E194B5\">!</span><span style=\"color:#007CF0;--shiki-dark:#007CF0\">header</span><span style=\"--shiki-dark:#FFD700;color:#FFD700\">)</span><span style=\"color:#000000;--shiki-dark:#B3D8E5\"> </span><span style=\"--shiki-dark:#FFD700;color:#FFD700\">{</span></span>\n<span class=\"line\"><span style=\"color:#007CF0;--shiki-dark:#007CF0\">        header</span><span style=\"color:#E194B5;--shiki-dark:#E194B5\"> =</span><span style=\"color:#000000;--shiki-dark:#B3D8E5\"> </span><span style=\"--shiki-dark:#DA70D6;color:#DA70D6\">{</span></span>\n<span class=\"line\"><span style=\"color:#007CF0;--shiki-dark:#007CF0\">          type:</span><span style=\"color:#007CF0;--shiki-dark:#007CF0\"> 'element'</span><span style=\"color:#000000;--shiki-dark:#B3D8E5\">,</span></span>\n<span class=\"line\"><span style=\"color:#007CF0;--shiki-dark:#007CF0\">          tagName:</span><span style=\"color:#007CF0;--shiki-dark:#007CF0\"> 'div'</span><span style=\"color:#000000;--shiki-dark:#B3D8E5\">,</span></span>\n<span class=\"line\"><span style=\"color:#007CF0;--shiki-dark:#007CF0\">          properties:</span><span style=\"color:#000000;--shiki-dark:#B3D8E5\"> </span><span style=\"--shiki-dark:#179FFF;color:#179FFF\">{</span><span style=\"color:#000000;--shiki-dark:#B3D8E5\"> </span><span style=\"color:#007CF0;--shiki-dark:#007CF0\">className:</span><span style=\"color:#000000;--shiki-dark:#B3D8E5\"> </span><span style=\"--shiki-dark:#FFD700;color:#FFD700\">[</span><span style=\"color:#007CF0;--shiki-dark:#007CF0\">'code-header'</span><span style=\"--shiki-dark:#FFD700;color:#FFD700\">]</span><span style=\"color:#000000;--shiki-dark:#B3D8E5\"> </span><span style=\"--shiki-dark:#179FFF;color:#179FFF\">}</span><span style=\"color:#000000;--shiki-dark:#B3D8E5\">,</span></span>\n<span class=\"line\"><span style=\"color:#007CF0;--shiki-dark:#007CF0\">          children:</span><span style=\"color:#000000;--shiki-dark:#B3D8E5\"> </span><span style=\"--shiki-dark:#179FFF;color:#179FFF\">[</span><span style=\"--shiki-dark:#179FFF;color:#179FFF\">]</span><span style=\"color:#000000;--shiki-dark:#B3D8E5\">,</span></span>\n<span class=\"line\"><span style=\"color:#000000;--shiki-dark:#B3D8E5\">        </span><span style=\"--shiki-dark:#DA70D6;color:#DA70D6\">}</span><span style=\"color:#000000;--shiki-dark:#B3D8E5\">;</span></span>\n<span class=\"line\"><span style=\"color:#007CF0;--shiki-dark:#007CF0\">        node</span><span style=\"color:#000000;--shiki-dark:#B3D8E5\">.</span><span style=\"color:#007CF0;--shiki-dark:#007CF0\">children</span><span style=\"color:#000000;--shiki-dark:#B3D8E5\">.</span><span style=\"color:#E2657E;--shiki-dark:#E2657E\">unshift</span><span style=\"--shiki-dark:#DA70D6;color:#DA70D6\">(</span><span style=\"color:#007CF0;--shiki-dark:#007CF0\">header</span><span style=\"--shiki-dark:#DA70D6;color:#DA70D6\">)</span><span style=\"color:#000000;--shiki-dark:#B3D8E5\">;</span></span>\n<span class=\"line\"><span style=\"color:#000000;--shiki-dark:#B3D8E5\">      </span><span style=\"--shiki-dark:#FFD700;color:#FFD700\">}</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"color:#6A9955;--shiki-dark:#6A9955\">      // Add language badge to header</span></span>\n<span class=\"line\"><span style=\"color:#007CF0;--shiki-dark:#007CF0\">      header</span><span style=\"color:#000000;--shiki-dark:#B3D8E5\">.</span><span style=\"color:#007CF0;--shiki-dark:#007CF0\">children</span><span style=\"color:#000000;--shiki-dark:#B3D8E5\">.</span><span style=\"color:#E2657E;--shiki-dark:#E2657E\">push</span><span style=\"--shiki-dark:#FFD700;color:#FFD700\">(</span><span style=\"--shiki-dark:#DA70D6;color:#DA70D6\">{</span></span>\n<span class=\"line\"><span style=\"color:#007CF0;--shiki-dark:#007CF0\">        type:</span><span style=\"color:#007CF0;--shiki-dark:#007CF0\"> 'element'</span><span style=\"color:#000000;--shiki-dark:#B3D8E5\">,</span></span>\n<span class=\"line\"><span style=\"color:#007CF0;--shiki-dark:#007CF0\">        tagName:</span><span style=\"color:#007CF0;--shiki-dark:#007CF0\"> 'span'</span><span style=\"color:#000000;--shiki-dark:#B3D8E5\">,</span></span>\n<span class=\"line\"><span style=\"color:#007CF0;--shiki-dark:#007CF0\">        properties:</span><span style=\"color:#000000;--shiki-dark:#B3D8E5\"> </span><span style=\"--shiki-dark:#179FFF;color:#179FFF\">{</span></span>\n<span class=\"line\"><span style=\"color:#007CF0;--shiki-dark:#007CF0\">          className:</span><span style=\"color:#000000;--shiki-dark:#B3D8E5\"> </span><span style=\"--shiki-dark:#FFD700;color:#FFD700\">[</span><span style=\"color:#007CF0;--shiki-dark:#007CF0\">'language-badge'</span><span style=\"--shiki-dark:#FFD700;color:#FFD700\">]</span><span style=\"color:#000000;--shiki-dark:#B3D8E5\">,</span></span>\n<span class=\"line\"><span style=\"color:#007CF0;--shiki-dark:#007CF0\">          'data-language'</span><span style=\"color:#007CF0;--shiki-dark:#007CF0\">:</span><span style=\"color:#007CF0;--shiki-dark:#007CF0\"> lang</span></span>\n<span class=\"line\"><span style=\"color:#000000;--shiki-dark:#B3D8E5\">        </span><span style=\"--shiki-dark:#179FFF;color:#179FFF\">}</span><span style=\"color:#000000;--shiki-dark:#B3D8E5\">,</span></span>\n<span class=\"line\"><span style=\"color:#007CF0;--shiki-dark:#007CF0\">        children:</span><span style=\"color:#000000;--shiki-dark:#B3D8E5\"> </span><span style=\"--shiki-dark:#179FFF;color:#179FFF\">[</span><span style=\"--shiki-dark:#FFD700;color:#FFD700\">{</span><span style=\"color:#000000;--shiki-dark:#B3D8E5\"> </span><span style=\"color:#007CF0;--shiki-dark:#007CF0\">type:</span><span style=\"color:#007CF0;--shiki-dark:#007CF0\"> 'text'</span><span style=\"color:#000000;--shiki-dark:#B3D8E5\">, </span><span style=\"color:#007CF0;--shiki-dark:#007CF0\">value:</span><span style=\"color:#007CF0;--shiki-dark:#007CF0\"> lang</span><span style=\"color:#000000;--shiki-dark:#B3D8E5\">.</span><span style=\"color:#E2657E;--shiki-dark:#E2657E\">toUpperCase</span><span style=\"--shiki-dark:#DA70D6;color:#DA70D6\">(</span><span style=\"--shiki-dark:#DA70D6;color:#DA70D6\">)</span><span style=\"color:#000000;--shiki-dark:#B3D8E5\"> </span><span style=\"--shiki-dark:#FFD700;color:#FFD700\">}</span><span style=\"--shiki-dark:#179FFF;color:#179FFF\">]</span><span style=\"color:#000000;--shiki-dark:#B3D8E5\">,</span></span>\n<span class=\"line\"><span style=\"color:#000000;--shiki-dark:#B3D8E5\">      </span><span style=\"--shiki-dark:#DA70D6;color:#DA70D6\">}</span><span style=\"--shiki-dark:#FFD700;color:#FFD700\">)</span><span style=\"color:#000000;--shiki-dark:#B3D8E5\">;</span></span>\n<span class=\"line\"><span style=\"color:#000000;--shiki-dark:#B3D8E5\">    </span><span style=\"--shiki-dark:#179FFF;color:#179FFF\">}</span></span>\n<span class=\"line\"><span style=\"color:#000000;--shiki-dark:#B3D8E5\">  </span><span style=\"--shiki-dark:#DA70D6;color:#DA70D6\">}</span><span style=\"color:#000000;--shiki-dark:#B3D8E5\">;</span></span>\n<span class=\"line\"><span style=\"--shiki-dark:#FFD700;color:#FFD700\">}</span></span></code></pre></div>\n<p>I created a custom transformer that stores language information in the root node's data attributes during the <code>root()</code> phase, then injects the badge element during the <code>pre()</code> phase when the parent container is available. This approach ensures the language badge appears in the header alongside titles and other metadata.</p>\n<h2>Advanced Features</h2>\n<h3>Diff Notation</h3>\n<p>Show additions and deletions in code:</p>\n<div class=\"shiki-wrapper\"><div class=\"shiki-header\"><div class=\"shiki-title\">Code Changes</div><div class=\"copy-button-placeholder\" data-code-id=\"code-block-1\"></div></div><div class=\"shiki-language\">TEXT</div><div class=\"copy-button-placeholder\" data-code-id=\"code-block-1\"></div><pre class=\"shiki shiki-themes theme-custom-light theme-custom-dark\" style=\"background-color:#f9f9f9;--shiki-dark-bg:#031030;color:#000000;--shiki-dark:#b3d8e5\" tabindex=\"0\" data-language=\"text\" id=\"code-block-1\"><code><span class=\"line\"><span style=\"color:#000000;--shiki-dark:#B3D8E5\">function calculateTotal</span><span style=\"--shiki-dark:#FFD700;color:#FFD700\">(</span><span style=\"color:#000000;--shiki-dark:#B3D8E5\">items</span><span style=\"--shiki-dark:#FFD700;color:#FFD700\">)</span><span style=\"color:#000000;--shiki-dark:#B3D8E5\"> </span><span style=\"--shiki-dark:#FFD700;color:#FFD700\">{</span></span>\n<span class=\"line\"><span style=\"color:#000000;--shiki-dark:#B3D8E5\">  let total = 0;</span></span>\n<span class=\"line diff remove\"><span style=\"color:#E2657E;--shiki-dark:#E2657E\">- for </span><span style=\"--shiki-dark:#DA70D6;color:#DA70D6\">(</span><span style=\"color:#E2657E;--shiki-dark:#E2657E\">let i = 0; i </span><span style=\"color:#E2657E;--shiki-dark:#E2657E\">&#x3C;</span><span style=\"color:#E2657E;--shiki-dark:#E2657E\"> items.length; i++</span><span style=\"--shiki-dark:#DA70D6;color:#DA70D6\">)</span><span style=\"color:#E2657E;--shiki-dark:#E2657E\"> </span><span style=\"--shiki-dark:#DA70D6;color:#DA70D6\">{</span></span>\n<span class=\"line diff remove\"><span style=\"color:#E2657E;--shiki-dark:#E2657E\">-   total += items</span><span style=\"--shiki-dark:#179FFF;color:#179FFF\">[</span><span style=\"color:#E2657E;--shiki-dark:#E2657E\">i</span><span style=\"--shiki-dark:#179FFF;color:#179FFF\">]</span><span style=\"color:#E2657E;--shiki-dark:#E2657E\">.price;</span></span>\n<span class=\"line diff remove\"><span style=\"color:#E2657E;--shiki-dark:#E2657E\">- </span><span style=\"--shiki-dark:#DA70D6;color:#DA70D6\">}</span></span>\n<span class=\"line diff add\"><span style=\"color:#007CF0;--shiki-dark:#007CF0\">+ total = items.reduce</span><span style=\"--shiki-dark:#DA70D6;color:#DA70D6\">(</span><span style=\"--shiki-dark:#179FFF;color:#179FFF\">(</span><span style=\"color:#007CF0;--shiki-dark:#007CF0\">sum, item</span><span style=\"--shiki-dark:#179FFF;color:#179FFF\">)</span><span style=\"color:#007CF0;--shiki-dark:#007CF0\"> =</span><span style=\"color:#007CF0;--shiki-dark:#007CF0\">></span><span style=\"color:#007CF0;--shiki-dark:#007CF0\"> sum + item.price, 0</span><span style=\"--shiki-dark:#DA70D6;color:#DA70D6\">)</span><span style=\"color:#007CF0;--shiki-dark:#007CF0\">;</span></span>\n<span class=\"line\"><span style=\"color:#000000;--shiki-dark:#B3D8E5\">  return total;</span></span>\n<span class=\"line\"><span style=\"--shiki-dark:#FFD700;color:#FFD700\">}</span></span></code></pre></div>\n<h3>Line Highlighting</h3>\n<p>Highlight specific lines to draw attention:</p>\n<div class=\"shiki-wrapper\"><div class=\"shiki-header\"><div class=\"shiki-title\">Important Lines</div><div class=\"copy-button-placeholder\" data-code-id=\"code-block-1\"></div></div><div class=\"shiki-language\">TEXT</div><div class=\"copy-button-placeholder\" data-code-id=\"code-block-1\"></div><pre class=\"shiki shiki-themes theme-custom-light theme-custom-dark\" style=\"background-color:#f9f9f9;--shiki-dark-bg:#031030;color:#000000;--shiki-dark:#b3d8e5\" tabindex=\"0\" data-language=\"text\" id=\"code-block-1\"><code><span class=\"line\"><span style=\"color:#569CD6;--shiki-dark:#569CD6\">const</span><span style=\"color:#E2657E;--shiki-dark:#E2657E\"> config</span><span style=\"color:#E194B5;--shiki-dark:#E194B5\"> =</span><span style=\"color:#000000;--shiki-dark:#B3D8E5\"> </span><span style=\"--shiki-dark:#FFD700;color:#FFD700\">{</span></span>\n<span class=\"line\"><span style=\"color:#007CF0;--shiki-dark:#007CF0\">  apiUrl:</span><span style=\"color:#007CF0;--shiki-dark:#007CF0\"> 'https://api.example.com'</span><span style=\"color:#000000;--shiki-dark:#B3D8E5\">,</span></span>\n<span class=\"line highlighted\"><span style=\"color:#007CF0;--shiki-dark:#007CF0\">  timeout:</span><span style=\"color:#B5CEA8;--shiki-dark:#B5CEA8\"> 5000</span><span style=\"color:#000000;--shiki-dark:#B3D8E5\">,           </span><span style=\"color:#6A9955;--shiki-dark:#6A9955\">// These lines are highlighted</span></span>\n<span class=\"line highlighted\"><span style=\"color:#007CF0;--shiki-dark:#007CF0\">  retryAttempts:</span><span style=\"color:#B5CEA8;--shiki-dark:#B5CEA8\"> 3</span><span style=\"color:#000000;--shiki-dark:#B3D8E5\">,        </span><span style=\"color:#6A9955;--shiki-dark:#6A9955\">// to show important config</span></span>\n<span class=\"line highlighted\"><span style=\"color:#007CF0;--shiki-dark:#007CF0\">  enableLogging:</span><span style=\"color:#E2657E;--shiki-dark:#E2657E\"> true</span><span style=\"color:#000000;--shiki-dark:#B3D8E5\">,     </span><span style=\"color:#6A9955;--shiki-dark:#6A9955\">// values</span></span>\n<span class=\"line\"><span style=\"color:#000000;--shiki-dark:#B3D8E5\">  </span></span>\n<span class=\"line\"><span style=\"color:#007CF0;--shiki-dark:#007CF0\">  headers:</span><span style=\"color:#000000;--shiki-dark:#B3D8E5\"> </span><span style=\"--shiki-dark:#DA70D6;color:#DA70D6\">{</span></span>\n<span class=\"line highlighted\"><span style=\"color:#007CF0;--shiki-dark:#007CF0\">    'Content-Type'</span><span style=\"color:#007CF0;--shiki-dark:#007CF0\">:</span><span style=\"color:#007CF0;--shiki-dark:#007CF0\"> 'application/json'</span><span style=\"color:#000000;--shiki-dark:#B3D8E5\">,  </span><span style=\"color:#6A9955;--shiki-dark:#6A9955\">// This line too!</span></span>\n<span class=\"line\"><span style=\"color:#000000;--shiki-dark:#B3D8E5\">  </span><span style=\"--shiki-dark:#DA70D6;color:#DA70D6\">}</span></span>\n<span class=\"line\"><span style=\"--shiki-dark:#FFD700;color:#FFD700\">}</span><span style=\"color:#000000;--shiki-dark:#B3D8E5\">;</span></span></code></pre></div>\n<h3>Word Highlighting</h3>\n<p>Highlight specific words or patterns:</p>\n<div class=\"shiki-wrapper\"><div class=\"shiki-header\"><div class=\"shiki-title\">Security Considerations</div><div class=\"copy-button-placeholder\" data-code-id=\"code-block-1\"></div></div><div class=\"shiki-language\">TEXT</div><div class=\"copy-button-placeholder\" data-code-id=\"code-block-1\"></div><pre class=\"shiki shiki-themes theme-custom-light theme-custom-dark\" style=\"background-color:#f9f9f9;--shiki-dark-bg:#031030;color:#000000;--shiki-dark:#b3d8e5\" tabindex=\"0\" data-language=\"text\" id=\"code-block-1\"><code><span class=\"line\"><span style=\"color:#569CD6;--shiki-dark:#569CD6\">const</span><span style=\"color:#E2657E;--shiki-dark:#E2657E\"> </span><span style=\"color:#E2657E;--shiki-dark:#E2657E\" class=\"highlighted-word\">password</span><span style=\"color:#E194B5;--shiki-dark:#E194B5\"> =</span><span style=\"color:#007CF0;--shiki-dark:#007CF0\"> \"secret123\"</span><span style=\"color:#000000;--shiki-dark:#B3D8E5\">; </span></span>\n<span class=\"line\"><span style=\"color:#569CD6;--shiki-dark:#569CD6\">const</span><span style=\"color:#E2657E;--shiki-dark:#E2657E\"> apiKey</span><span style=\"color:#E194B5;--shiki-dark:#E194B5\"> =</span><span style=\"color:#007CF0;--shiki-dark:#007CF0\"> process</span><span style=\"color:#000000;--shiki-dark:#B3D8E5\">.</span><span style=\"color:#007CF0;--shiki-dark:#007CF0\">env</span><span style=\"color:#000000;--shiki-dark:#B3D8E5\">.</span><span style=\"color:#E2657E;--shiki-dark:#E2657E\" class=\"highlighted-word\">API_KEY</span><span style=\"color:#000000;--shiki-dark:#B3D8E5\">; </span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"color:#569CD6;--shiki-dark:#569CD6\">function</span><span style=\"color:#E2657E;--shiki-dark:#E2657E\"> </span><span style=\"color:#E2657E;--shiki-dark:#E2657E\" class=\"highlighted-word\">authenticate</span><span style=\"--shiki-dark:#FFD700;color:#FFD700\">(</span><span style=\"color:#007CF0;--shiki-dark:#007CF0\">user</span><span style=\"color:#000000;--shiki-dark:#B3D8E5\">, </span><span style=\"color:#007CF0;--shiki-dark:#007CF0\">pass</span><span style=\"--shiki-dark:#FFD700;color:#FFD700\">)</span><span style=\"color:#000000;--shiki-dark:#B3D8E5\"> </span><span style=\"--shiki-dark:#FFD700;color:#FFD700\">{</span><span style=\"color:#000000;--shiki-dark:#B3D8E5\"> </span></span>\n<span class=\"line\"><span style=\"color:#6A9955;--shiki-dark:#6A9955\">  // Never store </span><span style=\"color:#6A9955;--shiki-dark:#6A9955\" class=\"highlighted-word\">password</span><span style=\"color:#6A9955;--shiki-dark:#6A9955\">s in plain text</span></span>\n<span class=\"line\"><span style=\"color:#569CD6;--shiki-dark:#569CD6\">  const</span><span style=\"color:#E2657E;--shiki-dark:#E2657E\"> hashedPassword</span><span style=\"color:#E194B5;--shiki-dark:#E194B5\"> =</span><span style=\"color:#E2657E;--shiki-dark:#E2657E\"> hash</span><span style=\"--shiki-dark:#DA70D6;color:#DA70D6\">(</span><span style=\"color:#007CF0;--shiki-dark:#007CF0\">pass</span><span style=\"--shiki-dark:#DA70D6;color:#DA70D6\">)</span><span style=\"color:#000000;--shiki-dark:#B3D8E5\">;</span></span>\n<span class=\"line\"><span style=\"color:#E194B5;--shiki-dark:#E194B5\">  return</span><span style=\"color:#E2657E;--shiki-dark:#E2657E\"> validateCredentials</span><span style=\"--shiki-dark:#DA70D6;color:#DA70D6\">(</span><span style=\"color:#007CF0;--shiki-dark:#007CF0\">user</span><span style=\"color:#000000;--shiki-dark:#B3D8E5\">, </span><span style=\"color:#007CF0;--shiki-dark:#007CF0\">hashedPassword</span><span style=\"--shiki-dark:#DA70D6;color:#DA70D6\">)</span><span style=\"color:#000000;--shiki-dark:#B3D8E5\">;</span></span>\n<span class=\"line\"><span style=\"--shiki-dark:#FFD700;color:#FFD700\">}</span></span></code></pre></div>\n<h3>Focus Lines</h3>\n<p>Focus on specific sections while dimming others:</p>\n<div class=\"shiki-wrapper\"><div class=\"shiki-header\"><div class=\"shiki-title\">Focus Example</div><div class=\"copy-button-placeholder\" data-code-id=\"code-block-1\"></div></div><div class=\"shiki-language\">TEXT</div><div class=\"copy-button-placeholder\" data-code-id=\"code-block-1\"></div><pre class=\"shiki shiki-themes theme-custom-light theme-custom-dark has-focused\" style=\"background-color:#f9f9f9;--shiki-dark-bg:#031030;color:#000000;--shiki-dark:#b3d8e5\" tabindex=\"0\" data-language=\"text\" id=\"code-block-1\"><code>\n<span class=\"line focused\"><span style=\"color:#569CD6;--shiki-dark:#569CD6\">function</span><span style=\"color:#E2657E;--shiki-dark:#E2657E\"> processUserData</span><span style=\"--shiki-dark:#FFD700;color:#FFD700\">(</span><span style=\"color:#007CF0;--shiki-dark:#007CF0\">userData</span><span style=\"--shiki-dark:#FFD700;color:#FFD700\">)</span><span style=\"color:#000000;--shiki-dark:#B3D8E5\"> </span><span style=\"--shiki-dark:#FFD700;color:#FFD700\">{</span></span>\n<span class=\"line focused\"><span style=\"color:#6A9955;--shiki-dark:#6A9955\">  // Validation</span></span>\n<span class=\"line focused\"><span style=\"color:#E194B5;--shiki-dark:#E194B5\">  if</span><span style=\"color:#000000;--shiki-dark:#B3D8E5\"> </span><span style=\"--shiki-dark:#DA70D6;color:#DA70D6\">(</span><span style=\"color:#E194B5;--shiki-dark:#E194B5\">!</span><span style=\"color:#007CF0;--shiki-dark:#007CF0\">userData</span><span style=\"color:#E194B5;--shiki-dark:#E194B5\"> ||</span><span style=\"color:#E194B5;--shiki-dark:#E194B5\"> !</span><span style=\"color:#007CF0;--shiki-dark:#007CF0\">userData</span><span style=\"color:#000000;--shiki-dark:#B3D8E5\">.</span><span style=\"color:#007CF0;--shiki-dark:#007CF0\">email</span><span style=\"--shiki-dark:#DA70D6;color:#DA70D6\">)</span><span style=\"color:#000000;--shiki-dark:#B3D8E5\"> </span><span style=\"--shiki-dark:#DA70D6;color:#DA70D6\">{</span></span>\n<span class=\"line focused\"><span style=\"color:#E194B5;--shiki-dark:#E194B5\">    throw</span><span style=\"color:#E194B5;--shiki-dark:#E194B5\"> new</span><span style=\"color:#E2657E;--shiki-dark:#E2657E\"> Error</span><span style=\"--shiki-dark:#179FFF;color:#179FFF\">(</span><span style=\"color:#007CF0;--shiki-dark:#007CF0\">'Invalid user data'</span><span style=\"--shiki-dark:#179FFF;color:#179FFF\">)</span><span style=\"color:#000000;--shiki-dark:#B3D8E5\">;</span></span>\n<span class=\"line\"><span style=\"color:#000000;--shiki-dark:#B3D8E5\">  </span><span style=\"--shiki-dark:#DA70D6;color:#DA70D6\">}</span></span>\n<span class=\"line\"><span style=\"color:#000000;--shiki-dark:#B3D8E5\">  </span></span>\n<span class=\"line\"><span style=\"color:#6A9955;--shiki-dark:#6A9955\">  // This is the important part to focus on</span></span>\n<span class=\"line\"><span style=\"color:#569CD6;--shiki-dark:#569CD6\">  const</span><span style=\"color:#E2657E;--shiki-dark:#E2657E\"> normalizedEmail</span><span style=\"color:#E194B5;--shiki-dark:#E194B5\"> =</span><span style=\"color:#007CF0;--shiki-dark:#007CF0\"> userData</span><span style=\"color:#000000;--shiki-dark:#B3D8E5\">.</span><span style=\"color:#007CF0;--shiki-dark:#007CF0\">email</span><span style=\"color:#000000;--shiki-dark:#B3D8E5\">.</span><span style=\"color:#E2657E;--shiki-dark:#E2657E\">toLowerCase</span><span style=\"--shiki-dark:#DA70D6;color:#DA70D6\">(</span><span style=\"--shiki-dark:#DA70D6;color:#DA70D6\">)</span><span style=\"color:#000000;--shiki-dark:#B3D8E5\">.</span><span style=\"color:#E2657E;--shiki-dark:#E2657E\">trim</span><span style=\"--shiki-dark:#DA70D6;color:#DA70D6\">(</span><span style=\"--shiki-dark:#DA70D6;color:#DA70D6\">)</span><span style=\"color:#000000;--shiki-dark:#B3D8E5\">;</span></span>\n<span class=\"line\"><span style=\"color:#569CD6;--shiki-dark:#569CD6\">  const</span><span style=\"color:#E2657E;--shiki-dark:#E2657E\"> username</span><span style=\"color:#E194B5;--shiki-dark:#E194B5\"> =</span><span style=\"color:#007CF0;--shiki-dark:#007CF0\"> normalizedEmail</span><span style=\"color:#000000;--shiki-dark:#B3D8E5\">.</span><span style=\"color:#E2657E;--shiki-dark:#E2657E\">split</span><span style=\"--shiki-dark:#DA70D6;color:#DA70D6\">(</span><span style=\"color:#007CF0;--shiki-dark:#007CF0\">'@'</span><span style=\"--shiki-dark:#DA70D6;color:#DA70D6\">)</span><span style=\"--shiki-dark:#DA70D6;color:#DA70D6\">[</span><span style=\"color:#B5CEA8;--shiki-dark:#B5CEA8\">0</span><span style=\"--shiki-dark:#DA70D6;color:#DA70D6\">]</span><span style=\"color:#000000;--shiki-dark:#B3D8E5\">;</span></span>\n<span class=\"line\"><span style=\"color:#000000;--shiki-dark:#B3D8E5\">  </span></span>\n<span class=\"line\"><span style=\"color:#6A9955;--shiki-dark:#6A9955\">  // Save to database</span></span>\n<span class=\"line\"><span style=\"color:#E194B5;--shiki-dark:#E194B5\">  return</span><span style=\"color:#E2657E;--shiki-dark:#E2657E\"> saveUser</span><span style=\"--shiki-dark:#DA70D6;color:#DA70D6\">(</span><span style=\"--shiki-dark:#179FFF;color:#179FFF\">{</span></span>\n<span class=\"line\"><span style=\"color:#E194B5;--shiki-dark:#E194B5\">    ...</span><span style=\"color:#007CF0;--shiki-dark:#007CF0\">userData</span><span style=\"color:#000000;--shiki-dark:#B3D8E5\">,</span></span>\n<span class=\"line\"><span style=\"color:#007CF0;--shiki-dark:#007CF0\">    email:</span><span style=\"color:#007CF0;--shiki-dark:#007CF0\"> normalizedEmail</span><span style=\"color:#000000;--shiki-dark:#B3D8E5\">,</span></span>\n<span class=\"line\"><span style=\"color:#007CF0;--shiki-dark:#007CF0\">    username</span></span>\n<span class=\"line\"><span style=\"color:#000000;--shiki-dark:#B3D8E5\">  </span><span style=\"--shiki-dark:#179FFF;color:#179FFF\">}</span><span style=\"--shiki-dark:#DA70D6;color:#DA70D6\">)</span><span style=\"color:#000000;--shiki-dark:#B3D8E5\">;</span></span>\n<span class=\"line\"><span style=\"--shiki-dark:#FFD700;color:#FFD700\">}</span></span></code></pre></div>\n<h3>Error Level Annotations</h3>\n<p>Show warnings and errors in code:</p>\n<div class=\"shiki-wrapper\"><div class=\"shiki-header\"><div class=\"shiki-title\">Error Handling</div><div class=\"copy-button-placeholder\" data-code-id=\"code-block-1\"></div></div><div class=\"shiki-language\">TEXT</div><div class=\"copy-button-placeholder\" data-code-id=\"code-block-1\"></div><pre class=\"shiki shiki-themes theme-custom-light theme-custom-dark has-highlighted\" style=\"background-color:#f9f9f9;--shiki-dark-bg:#031030;color:#000000;--shiki-dark:#b3d8e5\" tabindex=\"0\" data-language=\"text\" id=\"code-block-1\"><code><span class=\"line\"><span style=\"color:#569CD6;--shiki-dark:#569CD6\">function</span><span style=\"color:#E2657E;--shiki-dark:#E2657E\"> divideNumbers</span><span style=\"--shiki-dark:#FFD700;color:#FFD700\">(</span><span style=\"color:#007CF0;--shiki-dark:#007CF0\">a</span><span style=\"color:#000000;--shiki-dark:#B3D8E5\">, </span><span style=\"color:#007CF0;--shiki-dark:#007CF0\">b</span><span style=\"--shiki-dark:#FFD700;color:#FFD700\">)</span><span style=\"color:#000000;--shiki-dark:#B3D8E5\"> </span><span style=\"--shiki-dark:#FFD700;color:#FFD700\">{</span></span>\n<span class=\"line highlighted error\"><span style=\"color:#E194B5;--shiki-dark:#E194B5\">  if</span><span style=\"color:#000000;--shiki-dark:#B3D8E5\"> </span><span style=\"--shiki-dark:#DA70D6;color:#DA70D6\">(</span><span style=\"color:#007CF0;--shiki-dark:#007CF0\">b</span><span style=\"color:#E194B5;--shiki-dark:#E194B5\"> ===</span><span style=\"color:#B5CEA8;--shiki-dark:#B5CEA8\"> 0</span><span style=\"--shiki-dark:#DA70D6;color:#DA70D6\">)</span><span style=\"color:#000000;--shiki-dark:#B3D8E5\"> </span><span style=\"--shiki-dark:#DA70D6;color:#DA70D6\">{</span><span style=\"color:#000000;--shiki-dark:#B3D8E5\"> </span></span>\n<span class=\"line highlighted error\"><span style=\"color:#E194B5;--shiki-dark:#E194B5\">    throw</span><span style=\"color:#E194B5;--shiki-dark:#E194B5\"> new</span><span style=\"color:#E2657E;--shiki-dark:#E2657E\"> Error</span><span style=\"--shiki-dark:#179FFF;color:#179FFF\">(</span><span style=\"color:#007CF0;--shiki-dark:#007CF0\">'Division by zero!'</span><span style=\"--shiki-dark:#179FFF;color:#179FFF\">)</span><span style=\"color:#000000;--shiki-dark:#B3D8E5\">; </span></span>\n<span class=\"line\"><span style=\"color:#000000;--shiki-dark:#B3D8E5\">  </span><span style=\"--shiki-dark:#DA70D6;color:#DA70D6\">}</span></span>\n<span class=\"line\"><span style=\"color:#000000;--shiki-dark:#B3D8E5\">  </span></span>\n<span class=\"line highlighted warning\"><span style=\"color:#E194B5;--shiki-dark:#E194B5\">  if</span><span style=\"color:#000000;--shiki-dark:#B3D8E5\"> </span><span style=\"--shiki-dark:#DA70D6;color:#DA70D6\">(</span><span style=\"color:#E194B5;--shiki-dark:#E194B5\">typeof</span><span style=\"color:#007CF0;--shiki-dark:#007CF0\"> a</span><span style=\"color:#E194B5;--shiki-dark:#E194B5\"> !==</span><span style=\"color:#007CF0;--shiki-dark:#007CF0\"> 'number'</span><span style=\"color:#E194B5;--shiki-dark:#E194B5\"> ||</span><span style=\"color:#E194B5;--shiki-dark:#E194B5\"> typeof</span><span style=\"color:#007CF0;--shiki-dark:#007CF0\"> b</span><span style=\"color:#E194B5;--shiki-dark:#E194B5\"> !==</span><span style=\"color:#007CF0;--shiki-dark:#007CF0\"> 'number'</span><span style=\"--shiki-dark:#DA70D6;color:#DA70D6\">)</span><span style=\"color:#000000;--shiki-dark:#B3D8E5\"> </span><span style=\"--shiki-dark:#DA70D6;color:#DA70D6\">{</span><span style=\"color:#000000;--shiki-dark:#B3D8E5\"> </span></span>\n<span class=\"line highlighted warning\"><span style=\"color:#007CF0;--shiki-dark:#007CF0\">    console</span><span style=\"color:#000000;--shiki-dark:#B3D8E5\">.</span><span style=\"color:#E2657E;--shiki-dark:#E2657E\">warn</span><span style=\"--shiki-dark:#179FFF;color:#179FFF\">(</span><span style=\"color:#007CF0;--shiki-dark:#007CF0\">'Non-numeric input detected'</span><span style=\"--shiki-dark:#179FFF;color:#179FFF\">)</span><span style=\"color:#000000;--shiki-dark:#B3D8E5\">; </span></span>\n<span class=\"line\"><span style=\"color:#000000;--shiki-dark:#B3D8E5\">  </span><span style=\"--shiki-dark:#DA70D6;color:#DA70D6\">}</span></span>\n<span class=\"line\"><span style=\"color:#000000;--shiki-dark:#B3D8E5\">  </span></span>\n<span class=\"line\"><span style=\"color:#E194B5;--shiki-dark:#E194B5\">  return</span><span style=\"color:#007CF0;--shiki-dark:#007CF0\"> a</span><span style=\"color:#E194B5;--shiki-dark:#E194B5\"> /</span><span style=\"color:#007CF0;--shiki-dark:#007CF0\"> b</span><span style=\"color:#000000;--shiki-dark:#B3D8E5\">;</span></span>\n<span class=\"line\"><span style=\"--shiki-dark:#FFD700;color:#FFD700\">}</span></span></code></pre></div>\n<h2>Long Code with Horizontal Scrolling</h2>\n<p>Here's an example with long lines to demonstrate the copy button staying visible:</p>\n<div class=\"shiki-wrapper\"><div class=\"shiki-header\"><div class=\"shiki-title\">Long Lines Example</div><div class=\"copy-button-placeholder\" data-code-id=\"code-block-1\"></div></div><div class=\"shiki-language\">TEXT</div><div class=\"copy-button-placeholder\" data-code-id=\"code-block-1\"></div><pre class=\"shiki shiki-themes theme-custom-light theme-custom-dark\" style=\"background-color:#f9f9f9;--shiki-dark-bg:#031030;color:#000000;--shiki-dark:#b3d8e5\" tabindex=\"0\" data-language=\"text\" id=\"code-block-1\"><code><span class=\"line\"><span style=\"color:#569CD6;--shiki-dark:#569CD6\">const</span><span style=\"color:#E2657E;--shiki-dark:#E2657E\"> veryLongConfigurationObject</span><span style=\"color:#E194B5;--shiki-dark:#E194B5\"> =</span><span style=\"color:#000000;--shiki-dark:#B3D8E5\"> </span><span style=\"--shiki-dark:#FFD700;color:#FFD700\">{</span><span style=\"color:#000000;--shiki-dark:#B3D8E5\"> </span><span style=\"color:#007CF0;--shiki-dark:#007CF0\">apiEndpoint:</span><span style=\"color:#007CF0;--shiki-dark:#007CF0\"> \"https://api.example.com/v1/users\"</span><span style=\"color:#000000;--shiki-dark:#B3D8E5\">, </span><span style=\"color:#007CF0;--shiki-dark:#007CF0\">timeout:</span><span style=\"color:#B5CEA8;--shiki-dark:#B5CEA8\"> 5000</span><span style=\"color:#000000;--shiki-dark:#B3D8E5\">, </span><span style=\"color:#007CF0;--shiki-dark:#007CF0\">retryAttempts:</span><span style=\"color:#B5CEA8;--shiki-dark:#B5CEA8\"> 3</span><span style=\"color:#000000;--shiki-dark:#B3D8E5\">, </span><span style=\"color:#007CF0;--shiki-dark:#007CF0\">headers:</span><span style=\"color:#000000;--shiki-dark:#B3D8E5\"> </span><span style=\"--shiki-dark:#DA70D6;color:#DA70D6\">{</span><span style=\"color:#000000;--shiki-dark:#B3D8E5\"> </span><span style=\"color:#007CF0;--shiki-dark:#007CF0\">\"Content-Type\"</span><span style=\"color:#007CF0;--shiki-dark:#007CF0\">:</span><span style=\"color:#007CF0;--shiki-dark:#007CF0\"> \"application/json\"</span><span style=\"color:#000000;--shiki-dark:#B3D8E5\">, </span><span style=\"color:#007CF0;--shiki-dark:#007CF0\">\"Authorization\"</span><span style=\"color:#007CF0;--shiki-dark:#007CF0\">:</span><span style=\"color:#007CF0;--shiki-dark:#007CF0\"> \"Bearer token_goes_here\"</span><span style=\"color:#000000;--shiki-dark:#B3D8E5\"> </span><span style=\"--shiki-dark:#DA70D6;color:#DA70D6\">}</span><span style=\"color:#000000;--shiki-dark:#B3D8E5\">, </span><span style=\"color:#007CF0;--shiki-dark:#007CF0\">options:</span><span style=\"color:#000000;--shiki-dark:#B3D8E5\"> </span><span style=\"--shiki-dark:#DA70D6;color:#DA70D6\">{</span><span style=\"color:#000000;--shiki-dark:#B3D8E5\"> </span><span style=\"color:#007CF0;--shiki-dark:#007CF0\">enableCache:</span><span style=\"color:#E2657E;--shiki-dark:#E2657E\"> true</span><span style=\"color:#000000;--shiki-dark:#B3D8E5\">, </span><span style=\"color:#007CF0;--shiki-dark:#007CF0\">cacheTimeout:</span><span style=\"color:#B5CEA8;--shiki-dark:#B5CEA8\"> 3600</span><span style=\"color:#000000;--shiki-dark:#B3D8E5\">, </span><span style=\"color:#007CF0;--shiki-dark:#007CF0\">enableLogging:</span><span style=\"color:#E2657E;--shiki-dark:#E2657E\"> true</span><span style=\"color:#000000;--shiki-dark:#B3D8E5\">, </span><span style=\"color:#007CF0;--shiki-dark:#007CF0\">logLevel:</span><span style=\"color:#007CF0;--shiki-dark:#007CF0\"> \"debug\"</span><span style=\"color:#000000;--shiki-dark:#B3D8E5\"> </span><span style=\"--shiki-dark:#DA70D6;color:#DA70D6\">}</span><span style=\"color:#000000;--shiki-dark:#B3D8E5\"> </span><span style=\"--shiki-dark:#FFD700;color:#FFD700\">}</span><span style=\"color:#000000;--shiki-dark:#B3D8E5\">;</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"color:#569CD6;--shiki-dark:#569CD6\">const</span><span style=\"color:#E2657E;--shiki-dark:#E2657E\"> anotherLongLine</span><span style=\"color:#E194B5;--shiki-dark:#E194B5\"> =</span><span style=\"color:#007CF0;--shiki-dark:#007CF0\"> \"This is a very long string that extends far beyond the typical viewport width to demonstrate how the syntax highlighting handles horizontal scrolling while keeping the copy button accessible and visible at all times.\"</span><span style=\"color:#000000;--shiki-dark:#B3D8E5\">;</span></span></code></pre></div>\n<h2>Implementation Details: What Changed</h2>\n<h3>1. React-Based Copy Button with Dynamic Mounting</h3>\n<p>Replaced the inline SVG copy button with a React component that gets dynamically mounted:</p>\n<div class=\"shiki-wrapper\"><div class=\"shiki-header\"><div class=\"shiki-title\">hooks/useCodeBlocks.tsx - Dynamic Copy Button Mounting</div><div class=\"copy-button-placeholder\" data-code-id=\"code-block-1\"></div></div><div class=\"shiki-language\">TEXT</div><div class=\"copy-button-placeholder\" data-code-id=\"code-block-1\"></div><pre class=\"shiki shiki-themes theme-custom-light theme-custom-dark\" style=\"background-color:#f9f9f9;--shiki-dark-bg:#031030;color:#000000;--shiki-dark:#b3d8e5\" tabindex=\"0\" data-language=\"text\" id=\"code-block-1\"><code><span class=\"line\"><span style=\"color:#E194B5;--shiki-dark:#E194B5\">export</span><span style=\"color:#569CD6;--shiki-dark:#569CD6\"> function</span><span style=\"color:#E2657E;--shiki-dark:#E2657E\"> useCodeBlocks</span><span style=\"--shiki-dark:#FFD700;color:#FFD700\">(</span><span style=\"--shiki-dark:#FFD700;color:#FFD700\">)</span><span style=\"color:#000000;--shiki-dark:#B3D8E5\"> </span><span style=\"--shiki-dark:#FFD700;color:#FFD700\">{</span></span>\n<span class=\"line\"><span style=\"color:#569CD6;--shiki-dark:#569CD6\">  const</span><span style=\"color:#E2657E;--shiki-dark:#E2657E\"> rootsRef</span><span style=\"color:#E194B5;--shiki-dark:#E194B5\"> =</span><span style=\"color:#E2657E;--shiki-dark:#E2657E\"> useRef</span><span style=\"--shiki-dark:#DA70D6;color:#DA70D6\">&#x3C;</span><span style=\"color:#E2657E;--shiki-dark:#E2657E\">Map</span><span style=\"--shiki-dark:#179FFF;color:#179FFF\">&#x3C;</span><span style=\"color:#E2657E;--shiki-dark:#E2657E\">HTMLElement</span><span style=\"color:#000000;--shiki-dark:#B3D8E5\">, </span><span style=\"color:#E2657E;--shiki-dark:#E2657E\">Root</span><span style=\"--shiki-dark:#179FFF;color:#179FFF\">></span><span style=\"--shiki-dark:#DA70D6;color:#DA70D6\">></span><span style=\"--shiki-dark:#DA70D6;color:#DA70D6\">(</span><span style=\"color:#E194B5;--shiki-dark:#E194B5\">new</span><span style=\"color:#E2657E;--shiki-dark:#E2657E\"> Map</span><span style=\"--shiki-dark:#179FFF;color:#179FFF\">(</span><span style=\"--shiki-dark:#179FFF;color:#179FFF\">)</span><span style=\"--shiki-dark:#DA70D6;color:#DA70D6\">)</span><span style=\"color:#000000;--shiki-dark:#B3D8E5\">;</span></span>\n<span class=\"line\"><span style=\"color:#000000;--shiki-dark:#B3D8E5\">  </span></span>\n<span class=\"line\"><span style=\"color:#569CD6;--shiki-dark:#569CD6\">  const</span><span style=\"color:#E2657E;--shiki-dark:#E2657E\"> mountCopyButtons</span><span style=\"color:#E194B5;--shiki-dark:#E194B5\"> =</span><span style=\"color:#E2657E;--shiki-dark:#E2657E\"> useCallback</span><span style=\"--shiki-dark:#DA70D6;color:#DA70D6\">(</span><span style=\"--shiki-dark:#179FFF;color:#179FFF\">(</span><span style=\"--shiki-dark:#179FFF;color:#179FFF\">)</span><span style=\"color:#000000;--shiki-dark:#B3D8E5\"> </span><span style=\"color:#569CD6;--shiki-dark:#569CD6\">=</span><span style=\"color:#569CD6;--shiki-dark:#569CD6\">></span><span style=\"color:#000000;--shiki-dark:#B3D8E5\"> </span><span style=\"--shiki-dark:#179FFF;color:#179FFF\">{</span></span>\n<span class=\"line\"><span style=\"color:#569CD6;--shiki-dark:#569CD6\">    const</span><span style=\"color:#E2657E;--shiki-dark:#E2657E\"> placeholders</span><span style=\"color:#E194B5;--shiki-dark:#E194B5\"> =</span><span style=\"color:#007CF0;--shiki-dark:#007CF0\"> document</span><span style=\"color:#000000;--shiki-dark:#B3D8E5\">.</span><span style=\"color:#E2657E;--shiki-dark:#E2657E\">querySelectorAll</span><span style=\"--shiki-dark:#FFD700;color:#FFD700\">(</span><span style=\"color:#007CF0;--shiki-dark:#007CF0\">'.copy-button-placeholder'</span><span style=\"--shiki-dark:#FFD700;color:#FFD700\">)</span><span style=\"color:#000000;--shiki-dark:#B3D8E5\">;</span></span>\n<span class=\"line\"><span style=\"color:#000000;--shiki-dark:#B3D8E5\">    </span></span>\n<span class=\"line\"><span style=\"color:#007CF0;--shiki-dark:#007CF0\">    placeholders</span><span style=\"color:#000000;--shiki-dark:#B3D8E5\">.</span><span style=\"color:#E2657E;--shiki-dark:#E2657E\">forEach</span><span style=\"--shiki-dark:#FFD700;color:#FFD700\">(</span><span style=\"--shiki-dark:#DA70D6;color:#DA70D6\">(</span><span style=\"color:#007CF0;--shiki-dark:#007CF0\">placeholder</span><span style=\"--shiki-dark:#DA70D6;color:#DA70D6\">)</span><span style=\"color:#000000;--shiki-dark:#B3D8E5\"> </span><span style=\"color:#569CD6;--shiki-dark:#569CD6\">=</span><span style=\"color:#569CD6;--shiki-dark:#569CD6\">></span><span style=\"color:#000000;--shiki-dark:#B3D8E5\"> </span><span style=\"--shiki-dark:#DA70D6;color:#DA70D6\">{</span></span>\n<span class=\"line\"><span style=\"color:#569CD6;--shiki-dark:#569CD6\">      const</span><span style=\"color:#E2657E;--shiki-dark:#E2657E\"> element</span><span style=\"color:#E194B5;--shiki-dark:#E194B5\"> =</span><span style=\"color:#007CF0;--shiki-dark:#007CF0\"> placeholder</span><span style=\"color:#E194B5;--shiki-dark:#E194B5\"> as</span><span style=\"color:#E2657E;--shiki-dark:#E2657E\"> HTMLElement</span><span style=\"color:#000000;--shiki-dark:#B3D8E5\">;</span></span>\n<span class=\"line\"><span style=\"color:#569CD6;--shiki-dark:#569CD6\">      const</span><span style=\"color:#E2657E;--shiki-dark:#E2657E\"> codeId</span><span style=\"color:#E194B5;--shiki-dark:#E194B5\"> =</span><span style=\"color:#007CF0;--shiki-dark:#007CF0\"> element</span><span style=\"color:#000000;--shiki-dark:#B3D8E5\">.</span><span style=\"color:#E2657E;--shiki-dark:#E2657E\">getAttribute</span><span style=\"--shiki-dark:#179FFF;color:#179FFF\">(</span><span style=\"color:#007CF0;--shiki-dark:#007CF0\">'data-code-id'</span><span style=\"--shiki-dark:#179FFF;color:#179FFF\">)</span><span style=\"color:#000000;--shiki-dark:#B3D8E5\">;</span></span>\n<span class=\"line\"><span style=\"color:#000000;--shiki-dark:#B3D8E5\">      </span></span>\n<span class=\"line\"><span style=\"color:#E194B5;--shiki-dark:#E194B5\">      if</span><span style=\"color:#000000;--shiki-dark:#B3D8E5\"> </span><span style=\"--shiki-dark:#179FFF;color:#179FFF\">(</span><span style=\"color:#E194B5;--shiki-dark:#E194B5\">!</span><span style=\"color:#007CF0;--shiki-dark:#007CF0\">codeId</span><span style=\"color:#E194B5;--shiki-dark:#E194B5\"> ||</span><span style=\"color:#007CF0;--shiki-dark:#007CF0\"> rootsRef</span><span style=\"color:#000000;--shiki-dark:#B3D8E5\">.</span><span style=\"color:#007CF0;--shiki-dark:#007CF0\">current</span><span style=\"color:#000000;--shiki-dark:#B3D8E5\">.</span><span style=\"color:#E2657E;--shiki-dark:#E2657E\">has</span><span style=\"--shiki-dark:#FFD700;color:#FFD700\">(</span><span style=\"color:#007CF0;--shiki-dark:#007CF0\">element</span><span style=\"--shiki-dark:#FFD700;color:#FFD700\">)</span><span style=\"--shiki-dark:#179FFF;color:#179FFF\">)</span><span style=\"color:#000000;--shiki-dark:#B3D8E5\"> </span><span style=\"color:#E194B5;--shiki-dark:#E194B5\">return</span><span style=\"color:#000000;--shiki-dark:#B3D8E5\">;</span></span>\n<span class=\"line\"><span style=\"color:#000000;--shiki-dark:#B3D8E5\">      </span></span>\n<span class=\"line\"><span style=\"color:#569CD6;--shiki-dark:#569CD6\">      const</span><span style=\"color:#E2657E;--shiki-dark:#E2657E\"> root</span><span style=\"color:#E194B5;--shiki-dark:#E194B5\"> =</span><span style=\"color:#E2657E;--shiki-dark:#E2657E\"> createRoot</span><span style=\"--shiki-dark:#179FFF;color:#179FFF\">(</span><span style=\"color:#007CF0;--shiki-dark:#007CF0\">element</span><span style=\"--shiki-dark:#179FFF;color:#179FFF\">)</span><span style=\"color:#000000;--shiki-dark:#B3D8E5\">;</span></span>\n<span class=\"line\"><span style=\"color:#007CF0;--shiki-dark:#007CF0\">      root</span><span style=\"color:#000000;--shiki-dark:#B3D8E5\">.</span><span style=\"color:#E2657E;--shiki-dark:#E2657E\">render</span><span style=\"--shiki-dark:#179FFF;color:#179FFF\">(</span><span style=\"color:#000000;--shiki-dark:#B3D8E5\">&#x3C;</span><span style=\"color:#E2657E;--shiki-dark:#E2657E\">CopyButton</span><span style=\"color:#E2657E;--shiki-dark:#E2657E\"> codeId</span><span style=\"color:#000000;--shiki-dark:#B3D8E5\">=</span><span style=\"--shiki-dark:#FFD700;color:#FFD700\">{</span><span style=\"color:#007CF0;--shiki-dark:#007CF0\">codeId</span><span style=\"--shiki-dark:#FFD700;color:#FFD700\">}</span><span style=\"color:#000000;--shiki-dark:#B3D8E5\"> /</span><span style=\"color:#000000;--shiki-dark:#B3D8E5\">></span><span style=\"--shiki-dark:#179FFF;color:#179FFF\">)</span><span style=\"color:#000000;--shiki-dark:#B3D8E5\">;</span></span>\n<span class=\"line\"><span style=\"color:#007CF0;--shiki-dark:#007CF0\">      rootsRef</span><span style=\"color:#000000;--shiki-dark:#B3D8E5\">.</span><span style=\"color:#007CF0;--shiki-dark:#007CF0\">current</span><span style=\"color:#000000;--shiki-dark:#B3D8E5\">.</span><span style=\"color:#E2657E;--shiki-dark:#E2657E\">set</span><span style=\"--shiki-dark:#179FFF;color:#179FFF\">(</span><span style=\"color:#007CF0;--shiki-dark:#007CF0\">element</span><span style=\"color:#000000;--shiki-dark:#B3D8E5\">, </span><span style=\"color:#007CF0;--shiki-dark:#007CF0\">root</span><span style=\"--shiki-dark:#179FFF;color:#179FFF\">)</span><span style=\"color:#000000;--shiki-dark:#B3D8E5\">;</span></span>\n<span class=\"line\"><span style=\"color:#000000;--shiki-dark:#B3D8E5\">    </span><span style=\"--shiki-dark:#DA70D6;color:#DA70D6\">}</span><span style=\"--shiki-dark:#FFD700;color:#FFD700\">)</span><span style=\"color:#000000;--shiki-dark:#B3D8E5\">;</span></span>\n<span class=\"line\"><span style=\"color:#000000;--shiki-dark:#B3D8E5\">  </span><span style=\"--shiki-dark:#179FFF;color:#179FFF\">}</span><span style=\"color:#000000;--shiki-dark:#B3D8E5\">, </span><span style=\"--shiki-dark:#179FFF;color:#179FFF\">[</span><span style=\"--shiki-dark:#179FFF;color:#179FFF\">]</span><span style=\"--shiki-dark:#DA70D6;color:#DA70D6\">)</span><span style=\"color:#000000;--shiki-dark:#B3D8E5\">;</span></span>\n<span class=\"line\"><span style=\"color:#000000;--shiki-dark:#B3D8E5\">  </span></span>\n<span class=\"line\"><span style=\"color:#6A9955;--shiki-dark:#6A9955\">  // MutationObserver watches for new code blocks added dynamically</span></span>\n<span class=\"line\"><span style=\"color:#6A9955;--shiki-dark:#6A9955\">  // ... observer setup code</span></span>\n<span class=\"line\"><span style=\"--shiki-dark:#FFD700;color:#FFD700\">}</span></span></code></pre></div>\n<div class=\"shiki-wrapper\"><div class=\"shiki-header\"><div class=\"shiki-title\">components/CopyButton.tsx - React Copy Component</div><div class=\"copy-button-placeholder\" data-code-id=\"code-block-1\"></div></div><div class=\"shiki-language\">TEXT</div><div class=\"copy-button-placeholder\" data-code-id=\"code-block-1\"></div><pre class=\"shiki shiki-themes theme-custom-light theme-custom-dark\" style=\"background-color:#f9f9f9;--shiki-dark-bg:#031030;color:#000000;--shiki-dark:#b3d8e5\" tabindex=\"0\" data-language=\"text\" id=\"code-block-1\"><code><span class=\"line\"><span style=\"color:#E194B5;--shiki-dark:#E194B5\">export</span><span style=\"color:#E194B5;--shiki-dark:#E194B5\"> default</span><span style=\"color:#569CD6;--shiki-dark:#569CD6\"> function</span><span style=\"color:#E2657E;--shiki-dark:#E2657E\"> CopyButton</span><span style=\"--shiki-dark:#FFD700;color:#FFD700\">(</span><span style=\"--shiki-dark:#DA70D6;color:#DA70D6\">{</span><span style=\"color:#000000;--shiki-dark:#B3D8E5\"> </span><span style=\"color:#007CF0;--shiki-dark:#007CF0\">codeId</span><span style=\"color:#000000;--shiki-dark:#B3D8E5\"> </span><span style=\"--shiki-dark:#DA70D6;color:#DA70D6\">}</span><span style=\"color:#E194B5;--shiki-dark:#E194B5\">:</span><span style=\"color:#E2657E;--shiki-dark:#E2657E\"> CopyButtonProps</span><span style=\"--shiki-dark:#FFD700;color:#FFD700\">)</span><span style=\"color:#000000;--shiki-dark:#B3D8E5\"> </span><span style=\"--shiki-dark:#FFD700;color:#FFD700\">{</span></span>\n<span class=\"line\"><span style=\"color:#569CD6;--shiki-dark:#569CD6\">  const</span><span style=\"color:#000000;--shiki-dark:#B3D8E5\"> </span><span style=\"--shiki-dark:#DA70D6;color:#DA70D6\">[</span><span style=\"color:#E2657E;--shiki-dark:#E2657E\">copied</span><span style=\"color:#000000;--shiki-dark:#B3D8E5\">, </span><span style=\"color:#E2657E;--shiki-dark:#E2657E\">setCopied</span><span style=\"--shiki-dark:#DA70D6;color:#DA70D6\">]</span><span style=\"color:#000000;--shiki-dark:#B3D8E5\"> </span><span style=\"color:#E194B5;--shiki-dark:#E194B5\">=</span><span style=\"color:#E2657E;--shiki-dark:#E2657E\"> useState</span><span style=\"--shiki-dark:#DA70D6;color:#DA70D6\">(</span><span style=\"color:#E2657E;--shiki-dark:#E2657E\">false</span><span style=\"--shiki-dark:#DA70D6;color:#DA70D6\">)</span><span style=\"color:#000000;--shiki-dark:#B3D8E5\">;</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"color:#569CD6;--shiki-dark:#569CD6\">  const</span><span style=\"color:#E2657E;--shiki-dark:#E2657E\"> handleCopy</span><span style=\"color:#E194B5;--shiki-dark:#E194B5\"> =</span><span style=\"color:#569CD6;--shiki-dark:#569CD6\"> async</span><span style=\"color:#000000;--shiki-dark:#B3D8E5\"> </span><span style=\"--shiki-dark:#DA70D6;color:#DA70D6\">(</span><span style=\"--shiki-dark:#DA70D6;color:#DA70D6\">)</span><span style=\"color:#000000;--shiki-dark:#B3D8E5\"> </span><span style=\"color:#569CD6;--shiki-dark:#569CD6\">=</span><span style=\"color:#569CD6;--shiki-dark:#569CD6\">></span><span style=\"color:#000000;--shiki-dark:#B3D8E5\"> </span><span style=\"--shiki-dark:#DA70D6;color:#DA70D6\">{</span></span>\n<span class=\"line\"><span style=\"color:#569CD6;--shiki-dark:#569CD6\">    const</span><span style=\"color:#E2657E;--shiki-dark:#E2657E\"> codeElement</span><span style=\"color:#E194B5;--shiki-dark:#E194B5\"> =</span><span style=\"color:#007CF0;--shiki-dark:#007CF0\"> document</span><span style=\"color:#000000;--shiki-dark:#B3D8E5\">.</span><span style=\"color:#E2657E;--shiki-dark:#E2657E\">querySelector</span><span style=\"--shiki-dark:#179FFF;color:#179FFF\">(</span><span style=\"color:#007CF0;--shiki-dark:#007CF0\">`#</span><span style=\"color:#999999;--shiki-dark:#999999\">${</span><span style=\"color:#007CF0;--shiki-dark:#007CF0\">codeId</span><span style=\"color:#999999;--shiki-dark:#999999\">}</span><span style=\"color:#007CF0;--shiki-dark:#007CF0\"> code`</span><span style=\"--shiki-dark:#179FFF;color:#179FFF\">)</span><span style=\"color:#000000;--shiki-dark:#B3D8E5\">;</span></span>\n<span class=\"line\"><span style=\"color:#E194B5;--shiki-dark:#E194B5\">    if</span><span style=\"color:#000000;--shiki-dark:#B3D8E5\"> </span><span style=\"--shiki-dark:#179FFF;color:#179FFF\">(</span><span style=\"color:#E194B5;--shiki-dark:#E194B5\">!</span><span style=\"color:#007CF0;--shiki-dark:#007CF0\">codeElement</span><span style=\"--shiki-dark:#179FFF;color:#179FFF\">)</span><span style=\"color:#000000;--shiki-dark:#B3D8E5\"> </span><span style=\"color:#E194B5;--shiki-dark:#E194B5\">return</span><span style=\"color:#000000;--shiki-dark:#B3D8E5\">;</span></span>\n<span class=\"line\"><span style=\"color:#000000;--shiki-dark:#B3D8E5\">    </span></span>\n<span class=\"line\"><span style=\"color:#569CD6;--shiki-dark:#569CD6\">    const</span><span style=\"color:#E2657E;--shiki-dark:#E2657E\"> code</span><span style=\"color:#E194B5;--shiki-dark:#E194B5\"> =</span><span style=\"color:#007CF0;--shiki-dark:#007CF0\"> codeElement</span><span style=\"color:#000000;--shiki-dark:#B3D8E5\">.</span><span style=\"color:#007CF0;--shiki-dark:#007CF0\">textContent</span><span style=\"color:#E194B5;--shiki-dark:#E194B5\"> ||</span><span style=\"color:#007CF0;--shiki-dark:#007CF0\"> ''</span><span style=\"color:#000000;--shiki-dark:#B3D8E5\">;</span></span>\n<span class=\"line\"><span style=\"color:#E194B5;--shiki-dark:#E194B5\">    await</span><span style=\"color:#007CF0;--shiki-dark:#007CF0\"> navigator</span><span style=\"color:#000000;--shiki-dark:#B3D8E5\">.</span><span style=\"color:#007CF0;--shiki-dark:#007CF0\">clipboard</span><span style=\"color:#000000;--shiki-dark:#B3D8E5\">.</span><span style=\"color:#E2657E;--shiki-dark:#E2657E\">writeText</span><span style=\"--shiki-dark:#179FFF;color:#179FFF\">(</span><span style=\"color:#007CF0;--shiki-dark:#007CF0\">code</span><span style=\"--shiki-dark:#179FFF;color:#179FFF\">)</span><span style=\"color:#000000;--shiki-dark:#B3D8E5\">;</span></span>\n<span class=\"line\"><span style=\"color:#000000;--shiki-dark:#B3D8E5\">    </span></span>\n<span class=\"line\"><span style=\"color:#E2657E;--shiki-dark:#E2657E\">    setCopied</span><span style=\"--shiki-dark:#179FFF;color:#179FFF\">(</span><span style=\"color:#E2657E;--shiki-dark:#E2657E\">true</span><span style=\"--shiki-dark:#179FFF;color:#179FFF\">)</span><span style=\"color:#000000;--shiki-dark:#B3D8E5\">;</span></span>\n<span class=\"line\"><span style=\"color:#E2657E;--shiki-dark:#E2657E\">    setTimeout</span><span style=\"--shiki-dark:#179FFF;color:#179FFF\">(</span><span style=\"--shiki-dark:#FFD700;color:#FFD700\">(</span><span style=\"--shiki-dark:#FFD700;color:#FFD700\">)</span><span style=\"color:#000000;--shiki-dark:#B3D8E5\"> </span><span style=\"color:#569CD6;--shiki-dark:#569CD6\">=</span><span style=\"color:#569CD6;--shiki-dark:#569CD6\">></span><span style=\"color:#E2657E;--shiki-dark:#E2657E\"> setCopied</span><span style=\"--shiki-dark:#FFD700;color:#FFD700\">(</span><span style=\"color:#E2657E;--shiki-dark:#E2657E\">false</span><span style=\"--shiki-dark:#FFD700;color:#FFD700\">)</span><span style=\"color:#000000;--shiki-dark:#B3D8E5\">, </span><span style=\"color:#B5CEA8;--shiki-dark:#B5CEA8\">2000</span><span style=\"--shiki-dark:#179FFF;color:#179FFF\">)</span><span style=\"color:#000000;--shiki-dark:#B3D8E5\">;</span></span>\n<span class=\"line\"><span style=\"color:#000000;--shiki-dark:#B3D8E5\">  </span><span style=\"--shiki-dark:#DA70D6;color:#DA70D6\">}</span><span style=\"color:#000000;--shiki-dark:#B3D8E5\">;</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"color:#E194B5;--shiki-dark:#E194B5\">  return</span><span style=\"color:#000000;--shiki-dark:#B3D8E5\"> </span><span style=\"--shiki-dark:#DA70D6;color:#DA70D6\">(</span></span>\n<span class=\"line\"><span style=\"color:#999999;--shiki-dark:#999999\">    </span><span style=\"color:#999999;--shiki-dark:#999999\">&#x3C;</span><span style=\"color:#E2657E;--shiki-dark:#E2657E\">button</span><span style=\"color:#007CF0;--shiki-dark:#007CF0\"> className</span><span style=\"color:#E194B5;--shiki-dark:#E194B5\">=</span><span style=\"color:#007CF0;--shiki-dark:#007CF0\">\"shiki-copy-button\"</span><span style=\"color:#007CF0;--shiki-dark:#007CF0\"> onClick</span><span style=\"color:#E194B5;--shiki-dark:#E194B5\">=</span><span style=\"--shiki-dark:#179FFF;color:#179FFF\">{</span><span style=\"color:#007CF0;--shiki-dark:#007CF0\">handleCopy</span><span style=\"--shiki-dark:#179FFF;color:#179FFF\">}</span><span style=\"color:#999999;--shiki-dark:#999999\">></span></span>\n<span class=\"line\"><span style=\"color:#999999;--shiki-dark:#999999\">      </span><span style=\"--shiki-dark:#179FFF;color:#179FFF\">{</span><span style=\"color:#007CF0;--shiki-dark:#007CF0\">copied</span><span style=\"color:#E194B5;--shiki-dark:#E194B5\"> ?</span><span style=\"color:#999999;--shiki-dark:#999999\"> </span><span style=\"color:#999999;--shiki-dark:#999999\">&#x3C;</span><span style=\"color:#E2657E;--shiki-dark:#E2657E\">Check</span><span style=\"color:#007CF0;--shiki-dark:#007CF0\"> size</span><span style=\"color:#E194B5;--shiki-dark:#E194B5\">=</span><span style=\"--shiki-dark:#FFD700;color:#FFD700\">{</span><span style=\"color:#B5CEA8;--shiki-dark:#B5CEA8\">16</span><span style=\"--shiki-dark:#FFD700;color:#FFD700\">}</span><span style=\"color:#999999;--shiki-dark:#999999\"> /</span><span style=\"color:#999999;--shiki-dark:#999999\">></span><span style=\"color:#E194B5;--shiki-dark:#E194B5\"> :</span><span style=\"color:#999999;--shiki-dark:#999999\"> </span><span style=\"color:#999999;--shiki-dark:#999999\">&#x3C;</span><span style=\"color:#E2657E;--shiki-dark:#E2657E\">Copy</span><span style=\"color:#007CF0;--shiki-dark:#007CF0\"> size</span><span style=\"color:#E194B5;--shiki-dark:#E194B5\">=</span><span style=\"--shiki-dark:#FFD700;color:#FFD700\">{</span><span style=\"color:#B5CEA8;--shiki-dark:#B5CEA8\">16</span><span style=\"--shiki-dark:#FFD700;color:#FFD700\">}</span><span style=\"color:#999999;--shiki-dark:#999999\"> /</span><span style=\"color:#999999;--shiki-dark:#999999\">></span><span style=\"--shiki-dark:#179FFF;color:#179FFF\">}</span></span>\n<span class=\"line\"><span style=\"color:#999999;--shiki-dark:#999999\">    </span><span style=\"color:#999999;--shiki-dark:#999999\">&#x3C;</span><span style=\"color:#999999;--shiki-dark:#999999\">/</span><span style=\"color:#E2657E;--shiki-dark:#E2657E\">button</span><span style=\"color:#999999;--shiki-dark:#999999\">></span></span>\n<span class=\"line\"><span style=\"color:#000000;--shiki-dark:#B3D8E5\">  </span><span style=\"--shiki-dark:#DA70D6;color:#DA70D6\">)</span><span style=\"color:#000000;--shiki-dark:#B3D8E5\">;</span></span>\n<span class=\"line\"><span style=\"--shiki-dark:#FFD700;color:#FFD700\">}</span></span></code></pre></div>\n<h3>2. Custom Transformers for Enhanced Features</h3>\n<p>Created custom Shiki transformers to handle titles and diff lines:</p>\n<div class=\"shiki-wrapper\"><div class=\"shiki-header\"><div class=\"shiki-title\">utils.ts - Custom Title Transformer</div><div class=\"copy-button-placeholder\" data-code-id=\"code-block-1\"></div></div><div class=\"shiki-language\">TEXT</div><div class=\"copy-button-placeholder\" data-code-id=\"code-block-1\"></div><pre class=\"shiki shiki-themes theme-custom-light theme-custom-dark\" style=\"background-color:#f9f9f9;--shiki-dark-bg:#031030;color:#000000;--shiki-dark:#b3d8e5\" tabindex=\"0\" data-language=\"text\" id=\"code-block-1\"><code><span class=\"line\"><span style=\"color:#569CD6;--shiki-dark:#569CD6\">function</span><span style=\"color:#E2657E;--shiki-dark:#E2657E\"> transformerTitle</span><span style=\"--shiki-dark:#FFD700;color:#FFD700\">(</span><span style=\"--shiki-dark:#FFD700;color:#FFD700\">)</span><span style=\"color:#000000;--shiki-dark:#B3D8E5\"> </span><span style=\"--shiki-dark:#FFD700;color:#FFD700\">{</span></span>\n<span class=\"line\"><span style=\"color:#E194B5;--shiki-dark:#E194B5\">  return</span><span style=\"color:#000000;--shiki-dark:#B3D8E5\"> </span><span style=\"--shiki-dark:#DA70D6;color:#DA70D6\">{</span></span>\n<span class=\"line\"><span style=\"color:#007CF0;--shiki-dark:#007CF0\">    name:</span><span style=\"color:#007CF0;--shiki-dark:#007CF0\"> 'title'</span><span style=\"color:#000000;--shiki-dark:#B3D8E5\">,</span></span>\n<span class=\"line\"><span style=\"color:#E2657E;--shiki-dark:#E2657E\">    preprocess</span><span style=\"--shiki-dark:#179FFF;color:#179FFF\">(</span><span style=\"color:#007CF0;--shiki-dark:#007CF0\">code</span><span style=\"color:#000000;--shiki-dark:#B3D8E5\">, </span><span style=\"color:#007CF0;--shiki-dark:#007CF0\">options</span><span style=\"--shiki-dark:#179FFF;color:#179FFF\">)</span><span style=\"color:#000000;--shiki-dark:#B3D8E5\"> </span><span style=\"--shiki-dark:#179FFF;color:#179FFF\">{</span></span>\n<span class=\"line\"><span style=\"color:#6A9955;--shiki-dark:#6A9955\">      // Extract title from comments like: // [title: My Title]</span></span>\n<span class=\"line\"><span style=\"color:#E194B5;--shiki-dark:#E194B5\">      if</span><span style=\"color:#000000;--shiki-dark:#B3D8E5\"> </span><span style=\"--shiki-dark:#FFD700;color:#FFD700\">(</span><span style=\"color:#E194B5;--shiki-dark:#E194B5\">!</span><span style=\"color:#007CF0;--shiki-dark:#007CF0\">code</span><span style=\"color:#000000;--shiki-dark:#B3D8E5\">.</span><span style=\"color:#E2657E;--shiki-dark:#E2657E\">includes</span><span style=\"--shiki-dark:#DA70D6;color:#DA70D6\">(</span><span style=\"color:#007CF0;--shiki-dark:#007CF0\">'[title:'</span><span style=\"--shiki-dark:#DA70D6;color:#DA70D6\">)</span><span style=\"--shiki-dark:#FFD700;color:#FFD700\">)</span><span style=\"color:#000000;--shiki-dark:#B3D8E5\"> </span><span style=\"color:#E194B5;--shiki-dark:#E194B5\">return</span><span style=\"color:#007CF0;--shiki-dark:#007CF0\"> code</span><span style=\"color:#000000;--shiki-dark:#B3D8E5\">;</span></span>\n<span class=\"line\"><span style=\"color:#000000;--shiki-dark:#B3D8E5\">      </span></span>\n<span class=\"line\"><span style=\"color:#569CD6;--shiki-dark:#569CD6\">      const</span><span style=\"color:#E2657E;--shiki-dark:#E2657E\"> lines</span><span style=\"color:#E194B5;--shiki-dark:#E194B5\"> =</span><span style=\"color:#007CF0;--shiki-dark:#007CF0\"> code</span><span style=\"color:#000000;--shiki-dark:#B3D8E5\">.</span><span style=\"color:#E2657E;--shiki-dark:#E2657E\">split</span><span style=\"--shiki-dark:#FFD700;color:#FFD700\">(</span><span style=\"color:#007CF0;--shiki-dark:#007CF0\">'</span><span style=\"color:#E2657E;--shiki-dark:#E2657E\">\\n</span><span style=\"color:#007CF0;--shiki-dark:#007CF0\">'</span><span style=\"--shiki-dark:#FFD700;color:#FFD700\">)</span><span style=\"color:#000000;--shiki-dark:#B3D8E5\">;</span></span>\n<span class=\"line\"><span style=\"color:#569CD6;--shiki-dark:#569CD6\">      const</span><span style=\"color:#E2657E;--shiki-dark:#E2657E\"> firstLine</span><span style=\"color:#E194B5;--shiki-dark:#E194B5\"> =</span><span style=\"color:#007CF0;--shiki-dark:#007CF0\"> lines</span><span style=\"--shiki-dark:#FFD700;color:#FFD700\">[</span><span style=\"color:#B5CEA8;--shiki-dark:#B5CEA8\">0</span><span style=\"--shiki-dark:#FFD700;color:#FFD700\">]</span><span style=\"color:#000000;--shiki-dark:#B3D8E5\">;</span></span>\n<span class=\"line\"><span style=\"color:#569CD6;--shiki-dark:#569CD6\">      const</span><span style=\"color:#E2657E;--shiki-dark:#E2657E\"> titleStart</span><span style=\"color:#E194B5;--shiki-dark:#E194B5\"> =</span><span style=\"color:#007CF0;--shiki-dark:#007CF0\"> firstLine</span><span style=\"color:#000000;--shiki-dark:#B3D8E5\">.</span><span style=\"color:#E2657E;--shiki-dark:#E2657E\">indexOf</span><span style=\"--shiki-dark:#FFD700;color:#FFD700\">(</span><span style=\"color:#007CF0;--shiki-dark:#007CF0\">'[title:'</span><span style=\"--shiki-dark:#FFD700;color:#FFD700\">)</span><span style=\"color:#000000;--shiki-dark:#B3D8E5\">;</span></span>\n<span class=\"line\"><span style=\"color:#569CD6;--shiki-dark:#569CD6\">      const</span><span style=\"color:#E2657E;--shiki-dark:#E2657E\"> titleEnd</span><span style=\"color:#E194B5;--shiki-dark:#E194B5\"> =</span><span style=\"color:#007CF0;--shiki-dark:#007CF0\"> firstLine</span><span style=\"color:#000000;--shiki-dark:#B3D8E5\">.</span><span style=\"color:#E2657E;--shiki-dark:#E2657E\">indexOf</span><span style=\"--shiki-dark:#FFD700;color:#FFD700\">(</span><span style=\"color:#007CF0;--shiki-dark:#007CF0\">']'</span><span style=\"color:#000000;--shiki-dark:#B3D8E5\">, </span><span style=\"color:#007CF0;--shiki-dark:#007CF0\">titleStart</span><span style=\"--shiki-dark:#FFD700;color:#FFD700\">)</span><span style=\"color:#000000;--shiki-dark:#B3D8E5\">;</span></span>\n<span class=\"line\"><span style=\"color:#000000;--shiki-dark:#B3D8E5\">      </span></span>\n<span class=\"line\"><span style=\"color:#E194B5;--shiki-dark:#E194B5\">      if</span><span style=\"color:#000000;--shiki-dark:#B3D8E5\"> </span><span style=\"--shiki-dark:#FFD700;color:#FFD700\">(</span><span style=\"color:#007CF0;--shiki-dark:#007CF0\">titleStart</span><span style=\"color:#E194B5;--shiki-dark:#E194B5\"> !==</span><span style=\"color:#E194B5;--shiki-dark:#E194B5\"> -</span><span style=\"color:#B5CEA8;--shiki-dark:#B5CEA8\">1</span><span style=\"color:#E194B5;--shiki-dark:#E194B5\"> &#x26;&#x26;</span><span style=\"color:#007CF0;--shiki-dark:#007CF0\"> titleEnd</span><span style=\"color:#E194B5;--shiki-dark:#E194B5\"> </span><span style=\"color:#E194B5;--shiki-dark:#E194B5\">></span><span style=\"color:#007CF0;--shiki-dark:#007CF0\"> titleStart</span><span style=\"--shiki-dark:#FFD700;color:#FFD700\">)</span><span style=\"color:#000000;--shiki-dark:#B3D8E5\"> </span><span style=\"--shiki-dark:#FFD700;color:#FFD700\">{</span></span>\n<span class=\"line\"><span style=\"color:#569CD6;--shiki-dark:#569CD6\">        const</span><span style=\"color:#E2657E;--shiki-dark:#E2657E\"> title</span><span style=\"color:#E194B5;--shiki-dark:#E194B5\"> =</span><span style=\"color:#007CF0;--shiki-dark:#007CF0\"> firstLine</span><span style=\"color:#000000;--shiki-dark:#B3D8E5\">.</span><span style=\"color:#E2657E;--shiki-dark:#E2657E\">slice</span><span style=\"--shiki-dark:#DA70D6;color:#DA70D6\">(</span><span style=\"color:#007CF0;--shiki-dark:#007CF0\">titleStart</span><span style=\"color:#E194B5;--shiki-dark:#E194B5\"> +</span><span style=\"color:#B5CEA8;--shiki-dark:#B5CEA8\"> 7</span><span style=\"color:#000000;--shiki-dark:#B3D8E5\">, </span><span style=\"color:#007CF0;--shiki-dark:#007CF0\">titleEnd</span><span style=\"--shiki-dark:#DA70D6;color:#DA70D6\">)</span><span style=\"color:#000000;--shiki-dark:#B3D8E5\">.</span><span style=\"color:#E2657E;--shiki-dark:#E2657E\">trim</span><span style=\"--shiki-dark:#DA70D6;color:#DA70D6\">(</span><span style=\"--shiki-dark:#DA70D6;color:#DA70D6\">)</span><span style=\"color:#000000;--shiki-dark:#B3D8E5\">;</span></span>\n<span class=\"line\"><span style=\"color:#007CF0;--shiki-dark:#007CF0\">        options</span><span style=\"color:#000000;--shiki-dark:#B3D8E5\">.</span><span style=\"color:#007CF0;--shiki-dark:#007CF0\">meta</span><span style=\"color:#E194B5;--shiki-dark:#E194B5\"> =</span><span style=\"color:#000000;--shiki-dark:#B3D8E5\"> </span><span style=\"--shiki-dark:#DA70D6;color:#DA70D6\">{</span><span style=\"color:#000000;--shiki-dark:#B3D8E5\"> </span><span style=\"color:#E194B5;--shiki-dark:#E194B5\">...</span><span style=\"color:#007CF0;--shiki-dark:#007CF0\">options</span><span style=\"color:#000000;--shiki-dark:#B3D8E5\">.</span><span style=\"color:#007CF0;--shiki-dark:#007CF0\">meta</span><span style=\"color:#000000;--shiki-dark:#B3D8E5\">, </span><span style=\"color:#007CF0;--shiki-dark:#007CF0\">title</span><span style=\"color:#000000;--shiki-dark:#B3D8E5\"> </span><span style=\"--shiki-dark:#DA70D6;color:#DA70D6\">}</span><span style=\"color:#000000;--shiki-dark:#B3D8E5\">;</span></span>\n<span class=\"line\"><span style=\"color:#E194B5;--shiki-dark:#E194B5\">        return</span><span style=\"color:#007CF0;--shiki-dark:#007CF0\"> lines</span><span style=\"color:#000000;--shiki-dark:#B3D8E5\">.</span><span style=\"color:#E2657E;--shiki-dark:#E2657E\">slice</span><span style=\"--shiki-dark:#DA70D6;color:#DA70D6\">(</span><span style=\"color:#B5CEA8;--shiki-dark:#B5CEA8\">1</span><span style=\"--shiki-dark:#DA70D6;color:#DA70D6\">)</span><span style=\"color:#000000;--shiki-dark:#B3D8E5\">.</span><span style=\"color:#E2657E;--shiki-dark:#E2657E\">join</span><span style=\"--shiki-dark:#DA70D6;color:#DA70D6\">(</span><span style=\"color:#007CF0;--shiki-dark:#007CF0\">'</span><span style=\"color:#E2657E;--shiki-dark:#E2657E\">\\n</span><span style=\"color:#007CF0;--shiki-dark:#007CF0\">'</span><span style=\"--shiki-dark:#DA70D6;color:#DA70D6\">)</span><span style=\"color:#000000;--shiki-dark:#B3D8E5\">; </span><span style=\"color:#6A9955;--shiki-dark:#6A9955\">// Remove title line from code</span></span>\n<span class=\"line\"><span style=\"color:#000000;--shiki-dark:#B3D8E5\">      </span><span style=\"--shiki-dark:#FFD700;color:#FFD700\">}</span></span>\n<span class=\"line\"><span style=\"color:#E194B5;--shiki-dark:#E194B5\">      return</span><span style=\"color:#007CF0;--shiki-dark:#007CF0\"> code</span><span style=\"color:#000000;--shiki-dark:#B3D8E5\">;</span></span>\n<span class=\"line\"><span style=\"color:#000000;--shiki-dark:#B3D8E5\">    </span><span style=\"--shiki-dark:#179FFF;color:#179FFF\">}</span></span>\n<span class=\"line\"><span style=\"color:#000000;--shiki-dark:#B3D8E5\">  </span><span style=\"--shiki-dark:#DA70D6;color:#DA70D6\">}</span><span style=\"color:#000000;--shiki-dark:#B3D8E5\">;</span></span>\n<span class=\"line\"><span style=\"--shiki-dark:#FFD700;color:#FFD700\">}</span></span></code></pre></div>\n<div class=\"shiki-wrapper\"><div class=\"shiki-header\"><div class=\"shiki-title\">utils.ts - Diff Lines Transformer</div><div class=\"copy-button-placeholder\" data-code-id=\"code-block-1\"></div></div><div class=\"shiki-language\">TEXT</div><div class=\"copy-button-placeholder\" data-code-id=\"code-block-1\"></div><pre class=\"shiki shiki-themes theme-custom-light theme-custom-dark\" style=\"background-color:#f9f9f9;--shiki-dark-bg:#031030;color:#000000;--shiki-dark:#b3d8e5\" tabindex=\"0\" data-language=\"text\" id=\"code-block-1\"><code><span class=\"line\"><span style=\"color:#569CD6;--shiki-dark:#569CD6\">function</span><span style=\"color:#E2657E;--shiki-dark:#E2657E\"> transformerDiffLines</span><span style=\"--shiki-dark:#FFD700;color:#FFD700\">(</span><span style=\"--shiki-dark:#FFD700;color:#FFD700\">)</span><span style=\"color:#000000;--shiki-dark:#B3D8E5\"> </span><span style=\"--shiki-dark:#FFD700;color:#FFD700\">{</span></span>\n<span class=\"line\"><span style=\"color:#E194B5;--shiki-dark:#E194B5\">  return</span><span style=\"color:#000000;--shiki-dark:#B3D8E5\"> </span><span style=\"--shiki-dark:#DA70D6;color:#DA70D6\">{</span></span>\n<span class=\"line\"><span style=\"color:#007CF0;--shiki-dark:#007CF0\">    name:</span><span style=\"color:#007CF0;--shiki-dark:#007CF0\"> 'diff-lines'</span><span style=\"color:#000000;--shiki-dark:#B3D8E5\">,</span></span>\n<span class=\"line\"><span style=\"color:#E2657E;--shiki-dark:#E2657E\">    code</span><span style=\"--shiki-dark:#179FFF;color:#179FFF\">(</span><span style=\"color:#007CF0;--shiki-dark:#007CF0\">node</span><span style=\"--shiki-dark:#179FFF;color:#179FFF\">)</span><span style=\"color:#000000;--shiki-dark:#B3D8E5\"> </span><span style=\"--shiki-dark:#179FFF;color:#179FFF\">{</span></span>\n<span class=\"line\"><span style=\"color:#007CF0;--shiki-dark:#007CF0\">      node</span><span style=\"color:#000000;--shiki-dark:#B3D8E5\">.</span><span style=\"color:#007CF0;--shiki-dark:#007CF0\">children</span><span style=\"color:#000000;--shiki-dark:#B3D8E5\">?.</span><span style=\"color:#E2657E;--shiki-dark:#E2657E\">forEach</span><span style=\"--shiki-dark:#FFD700;color:#FFD700\">(</span><span style=\"--shiki-dark:#DA70D6;color:#DA70D6\">(</span><span style=\"color:#007CF0;--shiki-dark:#007CF0\">line</span><span style=\"--shiki-dark:#DA70D6;color:#DA70D6\">)</span><span style=\"color:#000000;--shiki-dark:#B3D8E5\"> </span><span style=\"color:#569CD6;--shiki-dark:#569CD6\">=</span><span style=\"color:#569CD6;--shiki-dark:#569CD6\">></span><span style=\"color:#000000;--shiki-dark:#B3D8E5\"> </span><span style=\"--shiki-dark:#DA70D6;color:#DA70D6\">{</span></span>\n<span class=\"line\"><span style=\"color:#569CD6;--shiki-dark:#569CD6\">        const</span><span style=\"color:#E2657E;--shiki-dark:#E2657E\"> firstText</span><span style=\"color:#E194B5;--shiki-dark:#E194B5\"> =</span><span style=\"color:#E2657E;--shiki-dark:#E2657E\"> getFirstText</span><span style=\"--shiki-dark:#179FFF;color:#179FFF\">(</span><span style=\"color:#007CF0;--shiki-dark:#007CF0\">line</span><span style=\"color:#000000;--shiki-dark:#B3D8E5\">.</span><span style=\"color:#007CF0;--shiki-dark:#007CF0\">children</span><span style=\"--shiki-dark:#FFD700;color:#FFD700\">[</span><span style=\"color:#B5CEA8;--shiki-dark:#B5CEA8\">0</span><span style=\"--shiki-dark:#FFD700;color:#FFD700\">]</span><span style=\"--shiki-dark:#179FFF;color:#179FFF\">)</span><span style=\"color:#000000;--shiki-dark:#B3D8E5\">;</span></span>\n<span class=\"line\"><span style=\"color:#000000;--shiki-dark:#B3D8E5\">        </span></span>\n<span class=\"line\"><span style=\"color:#E194B5;--shiki-dark:#E194B5\">        if</span><span style=\"color:#000000;--shiki-dark:#B3D8E5\"> </span><span style=\"--shiki-dark:#179FFF;color:#179FFF\">(</span><span style=\"color:#007CF0;--shiki-dark:#007CF0\">firstText</span><span style=\"color:#000000;--shiki-dark:#B3D8E5\">.</span><span style=\"color:#E2657E;--shiki-dark:#E2657E\">startsWith</span><span style=\"--shiki-dark:#FFD700;color:#FFD700\">(</span><span style=\"color:#007CF0;--shiki-dark:#007CF0\">'+'</span><span style=\"--shiki-dark:#FFD700;color:#FFD700\">)</span><span style=\"--shiki-dark:#179FFF;color:#179FFF\">)</span><span style=\"color:#000000;--shiki-dark:#B3D8E5\"> </span><span style=\"--shiki-dark:#179FFF;color:#179FFF\">{</span></span>\n<span class=\"line\"><span style=\"color:#6A9955;--shiki-dark:#6A9955\">          // Add classes for additions</span></span>\n<span class=\"line\"><span style=\"color:#007CF0;--shiki-dark:#007CF0\">          line</span><span style=\"color:#000000;--shiki-dark:#B3D8E5\">.</span><span style=\"color:#007CF0;--shiki-dark:#007CF0\">properties</span><span style=\"color:#000000;--shiki-dark:#B3D8E5\">.</span><span style=\"color:#007CF0;--shiki-dark:#007CF0\">class</span><span style=\"color:#000000;--shiki-dark:#B3D8E5\">.</span><span style=\"color:#E2657E;--shiki-dark:#E2657E\">push</span><span style=\"--shiki-dark:#FFD700;color:#FFD700\">(</span><span style=\"color:#007CF0;--shiki-dark:#007CF0\">'diff'</span><span style=\"color:#000000;--shiki-dark:#B3D8E5\">, </span><span style=\"color:#007CF0;--shiki-dark:#007CF0\">'add'</span><span style=\"--shiki-dark:#FFD700;color:#FFD700\">)</span><span style=\"color:#000000;--shiki-dark:#B3D8E5\">;</span></span>\n<span class=\"line\"><span style=\"color:#000000;--shiki-dark:#B3D8E5\">        </span><span style=\"--shiki-dark:#179FFF;color:#179FFF\">}</span><span style=\"color:#000000;--shiki-dark:#B3D8E5\"> </span><span style=\"color:#E194B5;--shiki-dark:#E194B5\">else</span><span style=\"color:#E194B5;--shiki-dark:#E194B5\"> if</span><span style=\"color:#000000;--shiki-dark:#B3D8E5\"> </span><span style=\"--shiki-dark:#179FFF;color:#179FFF\">(</span><span style=\"color:#007CF0;--shiki-dark:#007CF0\">firstText</span><span style=\"color:#000000;--shiki-dark:#B3D8E5\">.</span><span style=\"color:#E2657E;--shiki-dark:#E2657E\">startsWith</span><span style=\"--shiki-dark:#FFD700;color:#FFD700\">(</span><span style=\"color:#007CF0;--shiki-dark:#007CF0\">'-'</span><span style=\"--shiki-dark:#FFD700;color:#FFD700\">)</span><span style=\"--shiki-dark:#179FFF;color:#179FFF\">)</span><span style=\"color:#000000;--shiki-dark:#B3D8E5\"> </span><span style=\"--shiki-dark:#179FFF;color:#179FFF\">{</span></span>\n<span class=\"line\"><span style=\"color:#6A9955;--shiki-dark:#6A9955\">          // Add classes for deletions  </span></span>\n<span class=\"line\"><span style=\"color:#007CF0;--shiki-dark:#007CF0\">          line</span><span style=\"color:#000000;--shiki-dark:#B3D8E5\">.</span><span style=\"color:#007CF0;--shiki-dark:#007CF0\">properties</span><span style=\"color:#000000;--shiki-dark:#B3D8E5\">.</span><span style=\"color:#007CF0;--shiki-dark:#007CF0\">class</span><span style=\"color:#000000;--shiki-dark:#B3D8E5\">.</span><span style=\"color:#E2657E;--shiki-dark:#E2657E\">push</span><span style=\"--shiki-dark:#FFD700;color:#FFD700\">(</span><span style=\"color:#007CF0;--shiki-dark:#007CF0\">'diff'</span><span style=\"color:#000000;--shiki-dark:#B3D8E5\">, </span><span style=\"color:#007CF0;--shiki-dark:#007CF0\">'remove'</span><span style=\"--shiki-dark:#FFD700;color:#FFD700\">)</span><span style=\"color:#000000;--shiki-dark:#B3D8E5\">;</span></span>\n<span class=\"line\"><span style=\"color:#000000;--shiki-dark:#B3D8E5\">        </span><span style=\"--shiki-dark:#179FFF;color:#179FFF\">}</span></span>\n<span class=\"line\"><span style=\"color:#000000;--shiki-dark:#B3D8E5\">      </span><span style=\"--shiki-dark:#DA70D6;color:#DA70D6\">}</span><span style=\"--shiki-dark:#FFD700;color:#FFD700\">)</span><span style=\"color:#000000;--shiki-dark:#B3D8E5\">;</span></span>\n<span class=\"line\"><span style=\"color:#000000;--shiki-dark:#B3D8E5\">    </span><span style=\"--shiki-dark:#179FFF;color:#179FFF\">}</span></span>\n<span class=\"line\"><span style=\"color:#000000;--shiki-dark:#B3D8E5\">  </span><span style=\"--shiki-dark:#DA70D6;color:#DA70D6\">}</span><span style=\"color:#000000;--shiki-dark:#B3D8E5\">;</span></span>\n<span class=\"line\"><span style=\"--shiki-dark:#FFD700;color:#FFD700\">}</span></span></code></pre></div>\n<h3>3. Improved CSS Architecture</h3>\n<p>Rewrote the code block styles with:</p>\n<ul>\n<li>Table-based layout for proper line numbering</li>\n<li>Sticky positioning for line numbers during scroll</li>\n<li>Dark mode support with CSS custom properties</li>\n<li>Optimized Sass using scalable variable system (<code>$m-*</code> sizing, <code>$radius-*</code> for borders)</li>\n</ul>\n<h3>4. Giscus Theme &#x26; Dynamic Import Improvements</h3>\n<ul>\n<li>Switched from custom-hosted CSS to built-in Giscus themes (<code>dark</code>/<code>light</code>)</li>\n<li>Replaced lazy loading with Next.js dynamic imports for better SSR handling</li>\n<li>Added proper loading states and error boundaries</li>\n</ul>\n<h2>Conclusion</h2>\n<p>A few challenges came up during this implementation:</p>\n<p><strong>Transformer Execution Order</strong> - Understanding when each transformer hook executes was crucial. The <code>preprocess()</code> hook runs before tokenization, <code>code()</code> during rendering, and <code>pre()</code> after the code block is assembled. Getting data to flow between these stages required careful use of the options object and node properties.</p>\n<p><strong>React Hydration Issues</strong> - Server-rendered copy buttons failed to hydrate properly in Next.js. I solved this by using placeholders during SSR and dynamically mounting React components client-side with a MutationObserver to detect new code blocks.</p>\n<p><strong>Sticky Positioning in Tables</strong> - Achieving sticky line numbers while maintaining proper code alignment required switching from a flex layout to a table-based layout. This keeps line numbers visible during horizontal scrolling while the code content scrolls naturally.</p>\n<p><strong>Copy Button State Management</strong> - Managing the copied state across multiple code blocks required generating unique IDs for each block and ensuring the React components tracked which block was just copied from. The <code>data-code-id</code> attribute system solved this cleanly.</p>","slug":"shiki-syntax"},"__N_SSG":true}