{"pageProps":{"frontmatter":{"title":"Document Cookies Are a Useful Tool With A Simple API With Some Nunaces","meta":"This brief artice covers nuances of document.cookie and how to use it to store and access data.","categories":["code","javascript","html"],"date":"February 5, 2022","path":"/document-cookie-nuances"},"content":"<p><a href=\"https://developer.mozilla.org/en-US/docs/Web/API/Document/cookie\">Document Cookie</a> is a part of the HTML Document. It's used on many, if not most, websites to store data.\nAlthough, <code>document.cookie</code> is a string, there are subtle nuances to its API which can be misunderstood.\nIn this article, these nuances are explored in <em>just enough</em> detail to, hopefully, make <code>document.cookie</code> even more understandable.</p>\n<h2>The Basics of Document Cookie</h2>\n<p>Cookies can be created or referenced via the <code>document.cookie</code> property.</p>\n<p>To create a cookie, all that is needed is something very simple.</p>\n<pre class=\"language-javascript\"><code class=\"language-javascript code-highlight\"><span class=\"code-line\"><span class=\"token dom variable\">document</span><span class=\"token punctuation\">.</span><span class=\"token property-access\">cookie</span> <span class=\"token operator\">=</span> <span class=\"token string\">'&#x3C;key>=&#x3C;value>;'</span><span class=\"token punctuation\">;</span>\n</span></code></pre>\n<p>Reading cookies is very simple as well.</p>\n<pre class=\"language-javascript\"><code class=\"language-javascript code-highlight\"><span class=\"code-line\"><span class=\"token keyword\">const</span> cookies <span class=\"token operator\">=</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">UrlSearchParams</span><span class=\"token punctuation\">(</span><span class=\"token dom variable\">document</span><span class=\"token punctuation\">.</span><span class=\"token property-access\">cookie</span><span class=\"token punctuation\">.</span><span class=\"token method function property-access\">replaceAll</span><span class=\"token punctuation\">(</span><span class=\"token string\">'; '</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'&#x26;'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n</span><span class=\"code-line\">cookies<span class=\"token punctuation\">.</span><span class=\"token method function property-access\">get</span><span class=\"token punctuation\">(</span><span class=\"token string\">'&#x3C;key>'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n</span></code></pre>\n<h2>Cookie Attributes Are Write Only (Nuance 1)</h2>\n<p>After reading \"The Basics of Document Cookie\" section above, Cookies are incredibly simple to understand.\nHowever, if viewing <a href=\"https://developer.mozilla.org/en-US/docs/Web/API/Document/cookie\">MDN's</a> description of <code>document.cookie</code>, you'll notice attributes can be added to a cookie to control its behavior.\nThis concept is easy to understand. However, when viewing the API for adding attributes, it's slightly more confusing.</p>\n<pre class=\"language-javascript\"><code class=\"language-javascript code-highlight\"><span class=\"code-line\"><span class=\"token dom variable\">document</span><span class=\"token punctuation\">.</span><span class=\"token property-access\">cookie</span> <span class=\"token operator\">=</span> <span class=\"token string\">'&#x3C;key1>=value1; expires=&#x3C;date1>; path=&#x3C;path>; domain=&#x3C;domain>; secure; httponly'</span><span class=\"token punctuation\">;</span>\n</span><span class=\"code-line\"><span class=\"token dom variable\">document</span><span class=\"token punctuation\">.</span><span class=\"token property-access\">cookie</span> <span class=\"token operator\">=</span> <span class=\"token string\">'&#x3C;key2>=value2; expires=&#x3C;dat2>; path=&#x3C;path>;secure; httponly'</span><span class=\"token punctuation\">;</span>\n</span><span class=\"code-line\"><span class=\"token keyword\">const</span> cookies <span class=\"token operator\">=</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">UrlSearchParams</span><span class=\"token punctuation\">(</span><span class=\"token dom variable\">document</span><span class=\"token punctuation\">.</span><span class=\"token property-access\">cookie</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n</span><span class=\"code-line\"><span class=\"token known-class-name class-name\">Object</span><span class=\"token punctuation\">.</span><span class=\"token method function property-access\">fromEntries</span><span class=\"token punctuation\">(</span>cookies<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span> <span class=\"token comment\">// { key1: 'value1', key2: 'value2' }</span>\n</span></code></pre>\n<h3>Code Observations</h3>\n<ul>\n<li>When reading the cookie output, all attributes are removed</li>\n<li>Each cookie only has an accessible <code>key</code> and <code>value</code></li>\n</ul>\n<h3>Browser Observation</h3>\n<ul>\n<li>Cookie attributes can be viewed in the browser only!</li>\n</ul>\n<hr>\n<h2>Cookie Updates (Nuance 2)</h2>\n<p>Hint, a Cookie cannot be updated. It can only be re-written!\nThe good news is that because a cookie is only a string containing a key and value separated by a <code>=</code>, it is easy to find a replace with code.</p>\n<p>Lets see this in in action!</p>\n<pre class=\"language-javascript\"><code class=\"language-javascript code-highlight\"><span class=\"code-line\"><span class=\"token keyword\">const</span> cookies <span class=\"token operator\">=</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">UrlSearchParams</span><span class=\"token punctuation\">(</span><span class=\"token dom variable\">document</span><span class=\"token punctuation\">.</span><span class=\"token property-access\">cookie</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span> <span class=\"token comment\">// '&#x3C;key1>=&#x3C;value`>;&#x3C;key2>=&#x3C;value2>;'</span>\n</span><span class=\"code-line\">cookies<span class=\"token punctuation\">.</span><span class=\"token method function property-access\">set</span><span class=\"token punctuation\">(</span><span class=\"token string\">'&#x3C;key>'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'&#x3C;value>'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n</span><span class=\"code-line\"><span class=\"token comment\">// note: when adding attributes the code  to update a cookie is slightly more complex</span>\n</span></code></pre>\n<h3>Code Observation</h3>\n<ul>\n<li>Cookies can't be updated. They can be re-written!</li>\n<li>It is important to remember when re-writing a cookie to set necessary attributes!</li>\n<li>It is important when designing the tech spec of a cookie to plan for attributes being write-only!</li>\n</ul>\n<h3>Browser Obverations</h3>\n<ul>\n<li>When viewing <code>cookies</code> assigned to <code>document.cookie</code> in a string, <code>attributes</code> are removed</li>\n<li>Cookie key and value pairs are separated by a <code>=</code> within the <code>cookies</code> string.</li>\n<li>Cookies are separated by a <code>;</code> with the <code>cookies</code> string</li>\n</ul>\n<hr>\n<h2>Adding Multiple Cookies (Nuance 3)</h2>\n<p>When retrieving cookies, executing <code>console.log(document.cookie)</code>  will print all of the cookies on the document as key value pairs. In that same space, it isn’t far fetched to think multiple cookies could be added the same way—<code>document.cookie='foo=bar; biz=baz;'</code>. However, that could will only assign the first cookie.</p>\n<p>To add multiple cookies, each cookie must be added in a separate <code>document.cookie</code> assignment like the code block below.</p>\n<pre class=\"language-javascript\"><code class=\"language-javascript code-highlight\"><span class=\"code-line\">  <span class=\"token punctuation\">[</span><span class=\"token punctuation\">{</span> <span class=\"token literal-property property\">key</span><span class=\"token operator\">:</span> <span class=\"token string\">'foo'</span><span class=\"token punctuation\">,</span> <span class=\"token literal-property property\">value</span><span class=\"token operator\">:</span> <span class=\"token string\">'bar'</span> <span class=\"token punctuation\">}</span><span class=\"token punctuation\">,</span> <span class=\"token punctuation\">{</span> <span class=\"token literal-property property\">key</span><span class=\"token operator\">:</span> <span class=\"token string\">'biz'</span><span class=\"token punctuation\">,</span> <span class=\"token literal-property property\">value</span><span class=\"token operator\">:</span> <span class=\"token string\">'baz'</span> <span class=\"token punctuation\">}</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">.</span><span class=\"token method function property-access\">forEach</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">(</span><span class=\"token parameter\"><span class=\"token punctuation\">{</span> key<span class=\"token punctuation\">,</span> value <span class=\"token punctuation\">}</span></span><span class=\"token punctuation\">)</span> <span class=\"token arrow operator\">=></span> <span class=\"token dom variable\">document</span><span class=\"token punctuation\">.</span><span class=\"token property-access\">cookie</span> <span class=\"token operator\">=</span> <span class=\"token template-string\"><span class=\"token template-punctuation string\">`</span><span class=\"token interpolation\"><span class=\"token interpolation-punctuation punctuation\">${</span>key<span class=\"token interpolation-punctuation punctuation\">}</span></span><span class=\"token string\">=</span><span class=\"token interpolation\"><span class=\"token interpolation-punctuation punctuation\">${</span>value<span class=\"token interpolation-punctuation punctuation\">}</span></span><span class=\"token string\">;</span><span class=\"token template-punctuation string\">`</span></span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n</span><span class=\"code-line\">  <span class=\"token dom variable\">document</span><span class=\"token punctuation\">.</span><span class=\"token property-access\">cookie</span><span class=\"token punctuation\">;</span> <span class=\"token comment\">// 'foo=bar; biz=baz;'</span>\n</span></code></pre>\n<h3>Code Observation</h3>\n<ul>\n<li>Add cookies one at a time with the <code>document.cookie=\"&#x3C;key>=&#x3C;value>;\"</code> assignment</li>\n<li>Read cookies all at the same time by logging <code>document.cookie</code></li>\n<li>Each cookie must be added by assigning a key value pair to <code>document.cookie</code></li>\n</ul>\n<h2>Reading Multiple Added Cookies (Nuance 4)</h2>\n<p>When assigning a cookie, attributes are added with the same value as the key and value pair <code>=</code>, and <code>;</code>.\nWeirdly, when retrieving cookies, each cookie represented by a key and value pair is also seperated by a <code>=</code>, and a <code>;</code>.</p>\n<pre class=\"language-javascript\"><code class=\"language-javascript code-highlight\"><span class=\"code-line\"><span class=\"token dom variable\">document</span><span class=\"token punctuation\">.</span><span class=\"token property-access\">cookie</span> <span class=\"token operator\">=</span> <span class=\"token string\">'&#x3C;key1>=&#x3C;value1>; expires=&#x3C;date1>; path=&#x3C;path>; domain=&#x3C;domain>; secure; httponly'</span><span class=\"token punctuation\">;</span>\n</span><span class=\"code-line\"><span class=\"token dom variable\">document</span><span class=\"token punctuation\">.</span><span class=\"token property-access\">cookie</span><span class=\"token punctuation\">;</span> <span class=\"token comment\">// '&#x3C;key1>=&#x3C;value1>;'</span>\n</span></code></pre>\n<h3>Code Observation</h3>\n<ul>\n<li>Don't worry about creating a cookie string with attributes and not being able to filter it among cookies and attributes!</li>\n<li>Do worry about writing tech spec which accounts for expires to only be re-written, not updated!</li>\n<li>Remember cookie keys are are unique, in that if you assign a cookie with the same key, it will overwrite the other cookie!</li>\n</ul>\n<h2>Deleting Cookies (Nuance 5)</h2>\n<p>Deleting cookies is more complicated than expected. In order to delete the cookie, it must be assigned to no value as well as have its <code>Max-age</code> set to <code>-1</code>. It looks like this <code>document.cookie=\"foo=; Max-age=-1;\";</code> . There is much discussion on Stackoverflow and the internet on the best way to delete cookies. Often the use of the setting the <code>expires</code> attribute to a date in the past is mentioned. However, defining a historical date seems more complex that setting a the Max-age to <code>-1</code>.</p>\n<pre class=\"language-javascript\"><code class=\"language-javascript code-highlight\"><span class=\"code-line\">  <span class=\"token dom variable\">document</span><span class=\"token punctuation\">.</span><span class=\"token property-access\">cookie</span> <span class=\"token operator\">=</span> <span class=\"token string\">'foo=bar;'</span><span class=\"token punctuation\">;</span> <span class=\"token comment\">// foo=bar</span>\n</span><span class=\"code-line\">  <span class=\"token dom variable\">document</span><span class=\"token punctuation\">.</span><span class=\"token property-access\">cookie</span> <span class=\"token operator\">=</span> <span class=\"token string\">'foo=; Max-age=-1;'</span><span class=\"token punctuation\">;</span> <span class=\"token comment\">// empty</span>\n</span></code></pre>\n<h3>Code Observation</h3>\n<ul>\n<li>Delete cookies by assigning the cookie value to nothing and setting the Max-age or expires</li>\n<li><code>Max-age</code> looks like a cleaner way to delete cookies vs <code>expires</code></li>\n<li>Deleting cookies is can only be done 1 at a time, just like adding cookies</li>\n</ul>\n<h3>Browser Observations</h3>\n<ul>\n<li>If you only set the cookie value to empty (<code>document.cookie = \"foo=;\";</code>) (and don't set a Max-age or expires), the cookie will still display in the browser, but without value</li>\n<li>If you set the cookie value to empty and set the max-age to -1, the cookie will not display in the browser and will be deleted completely (<code>document.cookie = \"foo=;max-age=-1;\";</code>)</li>\n</ul>\n<h2>Final thoughts</h2>\n<p>Cookies are a very simple useful way to store data.\nThe fact that they are write-only and can't be updated is important to understand.\nOnce those 2 points are understood, using cookies should be fun and generally easy.\nLastely, attributes are valuable for managing cookie behavior and keeping them secure!\nJust remember they're only viewable in a browser's dev tools.</p>\n<hr>\n<p>Before writing this post, I did get caught up in the nuances I have tried to describe in this article.\nI always used <a href=\"https://github.com/js-cookie/js-cookie\">js-cookie</a> or similar so the nuances of <code>document.cookie</code> were hidden.\nI wrote this simple utility, <a href=\"https://github.com/yowainwright/mini-cookies\">mini-cookies</a> with 0 dependencies to abstract these nuaces—but in a very mimimal way.\nPlease reach out if you have suggestions!</p>\n<p>Happy Hacking!</p>","slug":"document-cookie-nuances"},"__N_SSG":true}